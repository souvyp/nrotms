jQuery=jQuery||window.jQuery;(function(h,o,j,l,n,k,g,c,q,i){h.fn.extend({sheet:function(s){var t=isNaN,r=h.sheet.events;s=s||{};h(this).each(function(){var A=Globalize,x=h(this),z={editable:true,editableNames:true,barMenus:true,freezableCells:true,allowToggleState:true,menuLeft:null,menuRight:null,newColumnWidth:120,title:null,calcOff:false,lockFormulas:false,parent:x,colMargin:18,boxModelCorrection:2,formulaFunctions:{},formulaVariables:{},cellSelectModel:"excel",autoAddCells:true,resizableCells:true,resizableSheet:true,autoFiller:true,minSize:{rows:1,cols:1},error:function(B){return B.error},endOfNumber:false,encode:function(B){switch(typeof B){case"object":if(B.getMonth){return A.format(B,"d")}return B}if(!B){return B||""}if(!B.replace){return B||""}return B.replace(/&/gi,"&amp;").replace(/>/gi,"&gt;").replace(/</gi,"&lt;").replace(/\n/g,"\n<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp ").replace(/  /g,"&nbsp; ")},frozenAt:[],contextmenuTop:{"Toggle freeze columns to here":function(C){var B=C.getTdLocation(C.obj.tdActive()).col;C.frozenAt().col=(C.frozenAt().col==B?0:B)},"Insert column after":function(B){B.controlFactory.addColumn(B.colLast);return false},"Insert column before":function(B){B.controlFactory.addColumn(B.colLast,true);return false},"Add column to end":function(B){B.controlFactory.addColumn();return false},"Delete this column":function(B){B.deleteColumn();return false},"Hide column":function(B){B.toggleHide.column();return false}},contextmenuLeft:{"Toggle freeze rows to here":function(B){var C=B.getTdLocation(B.obj.tdActive()).row;B.frozenAt().row=(B.frozenAt().row==C?0:C)},"Insert row after":function(B){B.controlFactory.addRow(B.rowLast);return false},"Insert row before":function(B){B.controlFactory.addRow(B.rowLast,true);return false},"Add row to end":function(B){B.controlFactory.addRow();return false},"Delete this row":function(B){B.deleteRow();return false},"Hide row":function(B){B.toggleHide.row();return false}},contextmenuCell:{Copy:false,Cut:false,"Insert column after":function(B){B.controlFactory.addColumn(B.colLast);return false},"Insert column before":function(B){B.controlFactory.addColumn(B.colLast,true);return false},"Add column to end":function(B){B.controlFactory.addColumn();return false},"Delete this column":function(B){B.deleteColumn();return false},line1:"line","Insert row after":function(B){B.controlFactory.addRow(B.rowLast);return false},"Insert row before":function(B){B.controlFactory.addRow(B.rowLast,true);return false},"Add row to end":function(B){B.controlFactory.addRow();return false},"Delete this row":function(B){B.deleteRow();return false},line2:"line","Add spreadsheet":function(B){B.addSheet()},"Delete spreadsheet":function(B){B.deleteSheet()}},hiddenRows:[],hiddenColumns:[],cellStartingHandlers:{"$":function(C,B){return e.DOLLAR.call(this,val.substring(1).replace(A.culture().numberFormat[","],""),2,B||"$")},"£":function(B){return y.s.cellStartingHandlers["$"].call(this,B,"£")}},cellEndHandlers:{"%":function(B){return B.substring(0,this.value.length-1)/100}},cellTypeHandlers:{percent:function(D){var C=(t(D)?A.parseFloat(D):D),B;if(!t(C)){B=new k(C);B.html=A.format(C,"p");return B}return D},date:function(C){var B=A.parseDate(C);B.html=A.format(B,"d");return B},time:function(C){var B=A.parseDate(C);B.html=A.format(B,"t");return B},currency:function(D){var C=(t(D)?A.parseFloat(D):D),B;if(!t(C)){B=new k(C);B.html=A.format(C,"c");return B}return C},number:function(D){var C,B;if(!s.endOfNumber){C=A.culture().numberFormat["."];s.endOfNumber=new q("(["+(C=="."?".":C)+"])([0-9]*?[1-9]+)?(0)*$")}if(!t(D)){B=new k(D);B.html=A.format(D+"","n10").replace(s.endOfNumber,function(G,F,E){return(E?F:"")+(E||"")});return B}return D}}};var y=this.jS;if(y){var v=x.children().detach();y.kill();x.html(v);for(var w in r){if(s[r[w]]){x.unbind(r[w])}}}if((this.className||"").match(/\bnotEditable\b/i)!=null){s.editable=false}for(var u in r){if(s[r[u]]){x.bind(r[u],s[r[u]])}}if(!h.sheet.instance.length){h.sheet.instance=[]}this.jS=y=h.sheet.createInstance(h.extend(z,s),h.sheet.instance.length);h.sheet.instance.push(y)});return this},disableSelectionSpecial:function(){this.each(function(){this.onselectstart=function(){return false};this.unselectable="on";this.style["-moz-user-select"]="none"});return this},getSheet:function(){var r=this[0],s=(r.jS||{});return s},getCellValue:function(w,s,r){var t=this[0],u=(t.jS||{});r=(r||0);if(u.updateCellValue){try{return u.updateCellValue(r,w,s)}catch(v){}}return null},setCellValue:function(w,y,t,s){var u=this[0],v=(u.jS||{}),r;s=(s||0);if(v.getCell&&(r=v.getCell(y,t,s))){try{r.value=w;r.valueOverride=r.formula="";r.calcLast=r.calcDependenciesLast=0;v.updateCellValue(s,y,t);return true}catch(x){}}return false},setCellFormula:function(y,x,t,s){var u=this[0],v=(u.jS||{}),r;s=(s||0);if(v.getCell&&(r=v.getCell(x,t,s))){try{r.formula=y;r.valueOverride=r.value="";r.calcLast=r.calcDependenciesLast=0;v.updateCellValue(s,x,t)}catch(w){}}return this},setCellHtml:function(u,y,t,s){var v=this[0],w=(v.jS||{}),r;s=(s||0);if(w.getCell&&(r=w.getCell(y,t,s))){try{r.html=[u];r.calcLast=r.calcDependenciesLast=0;w.updateCellValue(s,y,t)}catch(x){}}return this},isSheetFullScreen:function(){var r=this[0],s=(r.jS||{});if(s.obj){return s.obj.fullScreen().is(":visible")}return false},serializeCellInputs:function(s){var t=this[0],u=(t.jS||{}),r=u.obj.tables().find(":input");if(s){return r.serializeArray()}else{return r.serialize()}},viewSource:function(r){var s="";h(this).each(function(){if(r){s+=h(this).toPrettySource()}else{s+=h(this).toCompactSource()}});h.print(s);return s},toCompactSource:function(){var v=this[0];var s="";if(v.nodeType==1){s+="<"+v.tagName.toLowerCase();var x=v.attributes.length;for(var u=0;u<x;u++){var t=v.attributes[u].name,w=v.getAttribute(t);if(w){if(t=="contentEditable"&&w=="inherit"){continue}if(typeof(w)=="string"){s+=" "+t+'="'+w.replace(/"/g,"'")+'"'}else{if(t=="style"&&w.cssText){s+=' style="'+w.cssText+'"'}}}}if(v.tagName=="COL"){s+="/>"}else{s+=">";var r="";h(v.childNodes).each(function(){r+=h(this).toCompactSource()});s+=r;s+="</"+v.tagName.toLowerCase()+">"}}else{if(v.nodeType==3){s+=v.data.replace(/^\s*(.*)\s*$/g,"$1")}}return s},toPrettySource:function(w){var v=this[0],y,u;w=w||"";var s="";if(v.nodeType==1){s+="\n"+w+"<"+v.tagName.toLowerCase();y=v.attributes.length;for(u=0;u<y;u++){var t=v.attributes[u].name,x=v.getAttribute(t);if(x){if(t=="contentEditable"&&x=="inherit"){continue}if(typeof(x)=="string"){s+=" "+t+'="'+h.trim(x.replace(/"/g,"'"))+'"'}else{if(t=="style"&&x.cssText){s+=' style="'+h.trim(x.cssText)+'"'}}}}if(v.childNodes.length<=0){if(v.tagName=="COL"){s+="/>"}else{s+="></"+v.tagName.toLowerCase()+">"}}else{s+=">";var r="";y=v.childNodes.length;for(u=0;u<y;u++){r+=h(v.childNodes[u]).toPrettySource(w+"  ")}s+=r;if(r.indexOf("\n")>=0){s+="\n"+w}s+="</"+v.tagName.toLowerCase()+">"}}else{if(v.nodeType==3){s+=v.data.replace(/^\s*(.*)\s*$/g,"$1")}}return s},mousewheel:function(r){h(this).each(function(){this.onwheel=this.onmousewheel=this.onDOMMouseScroll=this.onMozMousePixelScroll=r});return this}});h.sheet={instance:[],dependencies:{coreCss:{css:"jquery.sheet.css"},jQueryUI:{script:"jquery-ui/ui/jquery-ui.min.js"},jQueryUIThemeRoller:{css:"jquery-ui/theme/jquery-ui.min.css"},globalize:{script:"plugins/globalize.js"},formulaParser:{script:"parser/formula/formula.js"},tsvParser:{script:"parser/tsv/tsv.js"},nearest:{script:"plugins/jquery.nearest.min.js"}},optional:{advancedFn:{script:"plugins/jquery.sheet.advancedfn.js"},dts:{script:"plugins/jquery.sheet.dts.js"},financeFn:{script:"plugins/jquery.sheet.financefn.js"},colorPicker:{css:"plugins/jquery.colorPicker.css",script:"plugins/jquery.colorPicker.min.js"},elastic:{script:"plugins/jquery.elastic.min.js"},globalizeCultures:{script:"plugins/globalize.cultures.js"},raphael:{script:"plugins/raphael-min.js"},gRaphael:{script:"plugins/g.raphael-min.js"},undoManager:{script:"plugins/undomanager.js"},zeroClipboard:{script:"plugins/ZeroClipboard.js"}},events:["sheetAddRow","sheetAddColumn","sheetSwitch","sheetRename","sheetTabSortStart","sheetTabSortUpdate","sheetCellEdit","sheetCellEdited","sheetCalculation","sheetAdd","sheetDelete","sheetDeleteRow","sheetDeleteColumn","sheetOpen","sheetAllOpened","sheetSave","sheetFullScreen","sheetFormulaKeydown"],preLoad:function(u,t){u=u||"";t=h.extend({skip:["globalizeCultures"]},t);var s=function(){if(this.script){o.write('<script src="'+u+this.script+'"><\/script>')}if(this.css){o.write('<link rel="stylesheet" type="text/css" href="'+u+this.css+'"></link>')}};for(var r in t.skip){if(this.dependencies[t.skip[r]]){this.dependencies[t.skip[r]]=null}if(this.optional[t.skip[r]]){this.optional[t.skip[r]]=null}}h.each(this.dependencies,function(){s.call(this)});h.each(this.optional,function(){s.call(this)})},repeat:function(t,s){var r="";while(s>0){if(s&1){r+=t}s>>=1;t+=t}return r},nthCss:function(z,v,u,r,t){var y=o.createElement("div"),x=o.createElement("div"),w=o.createElement("div"),s=o.createElement("style");o.body.appendChild(y);y.setAttribute("id","scrollTester");y.appendChild(x);y.appendChild(w);y.appendChild(s);if(s.styleSheet&&!s.styleSheet.disabled){s.styleSheet.cssText="#scrollTester div:nth-child(2) { display: none; }"}else{s.innerHTML="#scrollTester div:nth-child(2) { display: none; }"}if(h(w).is(":visible")){this.max=60;this.nthCss=function(A,G,C,E,D){var F=[],B=C.length;D=D||"{display: none;}";do{if(C[B]>E){F.push(G+" "+A+":first-child"+this.repeat("+"+A,C[B]-1))}}while(B--);if(F.length){return F.join(",")+D}return""}}else{this.nthCss=function(A,G,C,E,D){var F=[],B=C.length;D=D||"{display: none;}";do{if(C[B]>E){F.push(G+" "+A+":nth-child("+C[B]+")")}}while(B--);if(F.length){return F.join(",")+D}return""}}o.body.removeChild(y);return this.nthCss(z,v,u,r,t)},createInstance:function(J,D){var H=this,z=function(I,s){var u=s.parentNode;if(u.lastchild==s){u.appendChild(I)}else{u.insertBefore(I,s.nextSibling)}},r=h(j),x=h(o),A=o.body,w=h(A),E=function(){},G=undefined,C=c,v=isNaN,F=NaN,t=function(s){this.cells=s||[]},B=t.prototype={clone:function(){var I=[];for(var u=0;u<this.cells.length;u++){var s=this.cells[u],K={value:s.value,formula:s.formula,td:s.td,dependencies:s.dependencies,needsUpdated:s.needsUpdated,calcCount:s.calcCount,sheet:s.sheet,calcLast:s.calcLast,html:s.html,state:s.state,jS:s.jS,calcDependenciesLast:s.calcDependenciesLast,style:s.style||s.td.attr("style")||"",cl:s.cl||s.td.attr("class")||""};I.push(K)}return new t(I)}},y={version:"3.1 rc3",i:0,I:D,sheetCount:0,scrolledArea:[],spreadsheets:[],controls:{autoFiller:[],bar:{helper:[],corner:[],x:{controls:[],handleFreeze:[],menu:[],menuParent:[],parent:[],scroll:[],td:[],tds:function(){var u=h([]);for(var s in this.td[y.i]){u.pushStack(this.td[y.i][s])}return u}},y:{controls:[],handleFreeze:[],menu:[],parent:[],scroll:[],td:[],tds:function(){var u=h([]);for(var s in this.td[y.i]){u.pushStack(this.td[y.i][s])}return u}}},barMenuLeft:[],barMenuTop:[],barLeft:[],barTop:[],barTopParent:[],chart:[],tdMenu:[],cellsEdited:[],enclosure:[],enclosures:null,formula:null,fullScreen:null,header:null,inPlaceEdit:[],inputs:[],label:null,menuLeft:[],menuRight:[],menus:[],pane:[],panes:null,scroll:[],scrolls:null,table:[],tables:null,tab:[],tabContainer:null,tabs:null,title:null,toggleHide:{x:[],y:[]},ui:null},obj:{autoFiller:function(){return y.controls.autoFiller[y.i]||h([])},barCorner:function(){return y.controls.bar.corner[y.i]||h([])},barHelper:function(){return y.controls.bar.helper[y.i]||(y.controls.bar.helper[y.i]=h([]))},barLeft:function(s){return(y.controls.bar.y.td[y.i]&&y.controls.bar.y.td[y.i][s]?y.controls.bar.y.td[y.i][s]:h([]))},barLeftControls:function(){return y.controls.bar.y.controls[y.i]||h([])},barLefts:function(){return y.controls.bar.y.tds()},barHandleFreezeLeft:function(){return y.controls.bar.y.handleFreeze[y.i]||h([])},barMenuLeft:function(){return y.controls.bar.y.menu[y.i]||h([])},barTop:function(s){return(y.controls.bar.x.td[y.i]&&y.controls.bar.x.td[y.i][s]?y.controls.bar.x.td[y.i][s]:h([]))},barTopControls:function(){return y.controls.bar.x.controls[y.i]||h([])},barTops:function(){return y.controls.bar.x.tds()},barTopParent:function(){return y.controls.bar.x.parent[y.i]||h([])},barHandleFreezeTop:function(){return y.controls.bar.x.handleFreeze[y.i]||h([])},barMenuParentTop:function(){return y.controls.bar.x.menuParent[y.i]||h([])},barMenuTop:function(){return y.controls.bar.x.menu[y.i]||h([])},tdActive:function(){return y.cellLast.td||h([])},tdMenu:function(){return y.controls.tdMenu[y.i]||h([])},cellsEdited:function(){return y.controls.cellsEdited[y.i]||h([])},chart:function(){return y.controls.chart[y.i]||h([])},enclosure:function(){return y.controls.enclosure[y.i]||h([])},enclosures:function(){return y.controls.enclosures||h([])},formula:function(){return y.controls.formula||h([])},fullScreen:function(){return y.controls.fullScreen||h([])},header:function(){return y.controls.header||h([])},highlighted:function(){return y.highlightedLast.obj||h([])},menuRight:function(){return y.controls.menuRight[y.i]||h([])},inPlaceEdit:function(){return y.controls.inPlaceEdit[y.i]||h([])},inputs:function(){return y.controls.inputs[y.i]||h([])},label:function(){return y.controls.label||h([])},menus:function(){return y.controls.menus[y.i]||h([])},menuLeft:function(){return y.controls.menuLeft[y.i]||h([])},pane:function(){return y.controls.pane[y.i]||{}},panes:function(){return y.controls.panes||h([])},parent:function(){return J.parent},scrollStyleX:function(){return y.controls.bar.x.scroll[y.i]||{}},scrollStyleY:function(){return y.controls.bar.y.scroll[y.i]||h([])},scroll:function(){return y.controls.scroll[y.i]||h([])},scrolls:function(){return y.controls.scrolls||h([])},table:function(){return y.controls.table[y.i]||h([])},tables:function(){return y.controls.tables||h([])},tab:function(){return y.controls.tab[y.i]||h([])},tabs:function(){return y.controls.tabs||h([])},tabContainer:function(){return y.controls.tabContainer||h([])},toggleHideStyleX:function(){return y.controls.toggleHide.x[y.i]||h([])},toggleHideStyleY:function(){return y.controls.toggleHide.y[y.i]||h([])},title:function(){return y.controls.title||h([])},ui:function(){return y.controls.ui||h([])}},id:"jS_"+D+"_",cl:{autoFiller:"jSAutoFiller",autoFillerHandle:"jSAutoFillerHandle",autoFillerCover:"jSAutoFillerCover",barCorner:"jSBarCorner",barController:"jSBarController",barHelper:"jSBarHelper",barLeft:"jSBarLeft",barHandleFreezeLeft:"jSBarHandleFreezeLeft",barTop:"jSBarTop",barTopMenuButton:"jSBarTopMenuButton",barHandleFreezeTop:"jSBarHandleFreezeTop",barTopParent:"jSBarTopParent",chart:"jSChart",formula:"jSFormula",formulaParent:"jSFormulaParent",header:"jSHeader",fullScreen:"jSFullScreen",inPlaceEdit:"jSInPlaceEdit",menu:"jSMenu",menuFixed:"jSMenuFixed",parent:"jSParent",scroll:"jSScroll",table:"jS",label:"jSLoc",pane:"jSEditPane",tab:"jSTab",tabContainer:"jSTabContainer",tdMenu:"jSTdMenu",title:"jSTitle",enclosure:"jSEnclosure",ui:"jSUI",uiAutoFiller:"ui-state-active",uiBar:"ui-widget-header",uiBarHighlight:"ui-state-active",uiBarHandleFreezeLeft:"ui-state-default",uiBarHandleFreezeTop:"ui-state-default",uiBarMenuTop:"ui-state-default",uiTdActive:"ui-state-active",uiTdHighlighted:"ui-state-highlight",uiControl:"ui-widget-header ui-corner-top",uiControlTextBox:"ui-widget-content",uiFullScreen:"ui-widget-content ui-corner-all",uiInPlaceEdit:"ui-state-highlight",uiMenu:"ui-widget-header",uiMenuUl:"ui-widget-header",uiMenuLi:"ui-widget-header",uiPane:"ui-widget-content",uiParent:"ui-widget-content ui-corner-all",uiTable:"ui-widget-content",uiTab:"ui-widget-header",uiTabActive:"ui-state-highlight"},msg:{addRowMulti:"How many rows would you like to add?",addColumnMulti:"How many columns would you like to add?",cellFind:"What are you looking for in this spreadsheet?",cellNoFind:"No results found.",dragToFreezeCol:"Drag to freeze column",dragToFreezeRow:"Drag to freeze row",addSheet:"Add a spreadsheet",openSheet:"Are you sure you want to open a different sheet?  All unsaved changes will be lost.",toggleHideRow:"No row selected.",toggleHideColumn:"No column selected.",loopDetected:"Loop Detected",newSheetTitle:"What would you like the sheet's title to be?",notFoundColumn:"Column not found",notFoundRow:"Row not found",notFoundSheet:"Sheet not found",setCellRef:"Enter the name you would like to reference the cell by.",sheetTitleDefault:"Spreadsheet {index}",maxRowsBrowserLimitation:"You've reached the maximum amount of rows this browser supports. Try using Chrome, FireFox, or Internet Explorer 9+",maxColsBrowserLimitation:"You've reached the maximum amount of columns this browser supports. Try using Chrome, FireFox, or Internet Explorer 9+",maxSizeBrowserLimitationOnOpen:"The spreadsheet you are loading is larger than the maximum size of cells this browser supports. Try using Chrome, Firefox, or Internet Explorer 9+. You can an proceed, but the spreadsheet may not work as intended."},kill:function(){if(!y){return false}o.onkeydown=null;this.obj.fullScreen().remove();(this.obj.inPlaceEdit().destroy||E)();J.parent.trigger("sheetKill").removeClass(y.cl.uiParent).html("");J.parent[0].jS=G;this.obj.menus().remove();var s=h.sheet.events.length;for(var u=0;u<s;u++){J.parent.unbind(h.sheet.events[u])}h.sheet.instance.splice(D,1);return true},trigger:function(s,u){u=u||[];return J.parent.triggerHandler(s,[y].concat(u))},spreadsheetsToArray:function(s){if(s||y.spreadsheets.length==0){y.cycleCellsAll(function(I,K,u){y.createCell(I,K,u)})}return y.spreadsheets},spreadsheetToArray:function(u,s){s=(s?s:y.i);if(!y.spreadsheets[s]){y.cycleCells(function(K,L,I){y.createCell(K,L,I)})}return y.spreadsheets[s]},createCell:function(N,Q,S,V,U,Y){var I,O,R,u,X,T,K,L,s,P,M,Z,W;if(!(I=y.spreadsheets[N])){I=y.spreadsheets[N]=[]}if(!(O=I[Q])){O=I[Q]=[]}if(!(X=y.controls.tables[N])){return{}}if(!(L=X.tBody)){return{}}if(!(s=L.children[Q])){return{}}if(!(P=s.children[S])){return{}}M=h(P);R=O[S]=P.jSCell={td:M,dependencies:[],formula:P.getAttribute("data-formula")||"",cellType:P.getAttribute("data-celltype")||null,value:P.textContent||P.innerText||"",calcCount:V||0,calcLast:U||-1,calcDependenciesLast:Y||-1,sheet:N,type:"cell",jS:y,state:[],needsUpdated:true};if(R.formula&&R.formula.charAt(0)=="="){R.formula=R.formula.substring(1)}T=X.colGroup;while(!(K=T.children[S])){K=o.createElement("col");K.setAttribute("style","width:"+y.s.newColumnWidth+"px;");T.appendChild(K)}if(!(u=K.jSCells)){u=K.jSCells=[]}u.unshift(R);if(!K.tds){K.tds=[]}K.tds.unshift(P);P.col=K;P.type="cell";P.barLeft=s.children[0];P.barTop=L.children[0].children[S];if(!s.jSCells){s.jSCells=[]}s.jSCells.unshift(R);if(!s.tds){s.tds=[]}s.tds.unshift(P);if(!X.jSCells){X.jSCells=[]}X.jSCells.unshift(R);if(!X.tds){X.tds=[]}X.tds.unshift(P);P.table=X;if(!(W=y.controls.bar.y.td[N])){W=y.controls.bar.y.td[N]=[]}if(!W[Q]){W[Q]=h(s.children[0])}if(!(Z=y.controls.bar.x.td[N])){Z=y.controls.bar.x.td[N]=[]}if(!Z[S]){Z[S]=h(L.children[0].children[S])}return R},getCell:function(M,K,I){var u,L,s;I=(I||0);if(y.spreadsheets&&(u=y.spreadsheets[I])&&(L=u[M])&&(s=L[K])){return s}return null},nav:false,setNav:function(I){var s=h.sheet.instance;for(var u=0;u<s.length;u++){(s[u]||{}).nav=false}y.nav=I},controlFactory:{addRowMulti:function(I,K,u,s){if(!K){K=y.trigger("prompt",[y.msg.addRowMulti])}if(K){if(!v(K)){y.controlFactory.addCells(I,u,parseInt(K),"row",s);y.trigger("sheetAddRow",[I,u,K])}}},addColumnMulti:function(I,K,u,s){if(!K){K=y.trigger("prompt",[y.msg.addColumnMulti])}if(K){if(!v(K)){y.controlFactory.addCells(I,u,parseInt(K),"col",s);y.trigger("sheetAddColumn",[I,u,K])}}},addCells:function(R,P,W,V,L){y.autoFillerHide();y.setDirty(true);y.setChanged(true);y.obj.barHelper().remove();var T=y.obj.table(),U=T[0],s=y.sheetSize(U),Q=false,N=y.obj.tdActive(),I;W=W||1;V=V||"col";if(R==G){R=(V=="row"?s.rows:s.cols);Q=true}switch(V){case"row":if(h.sheet.max){if(h.sheet.max>s.rows&&h.sheet.max<=s.rows+W){W=h.sheet.max-s.rows}else{if(h.sheet.max&&h.sheet.max<=s.rows+W){if(!y.isBusy()){y.trigger("alert",[y.msg.maxRowsBrowserLimitation])}return false}}}I={el:function(){var X=y.rowTds(U,R);if(!X||!X[0]){return[]}return[X[0].parentNode]},size:function(){if(!I.Size){var X=I.el()[0];I.Size=X.children.length-1}return I.Size},loc:function(){var X=I.el();return y.getTdLocation(X[0].children)},trs:[],newObj:function(){var X=I.size(),Z=o.createElement("tr");Z.setAttribute("style","height: "+J.colMargin+"px;");for(var Y=0;Y<=X;Y++){var aa=o.createElement("td");if(Y==0){aa.setAttribute("class",y.cl.barLeft+" "+y.cl.uiBar);aa.entity="left";aa.type="bar"}Z.appendChild(aa)}I.trs.push(Z);return Z},offset:{row:W,col:0},start:function(){return{row:(P?R:R+W)}},createCells:function(){for(var Z=0;Z<I.trs.length;Z++){var Y=(P?0:1)+R;y.spreadsheets[y.i].splice(Z+Y,0,[]);for(var X=0;X<I.trs[Z].children.length;X++){if(X==0){y.controls.bar.y.td[y.i].splice(Z+Y,0,h(I.trs[Z].children[X]))}else{y.createCell(y.i,Z+Y,X)}}}y.refreshRowLabels(R)}};break;case"col":if(h.sheet.max){if(h.sheet.max>s.cols&&h.sheet.max<=s.cols+W){W=h.sheet.max-s.cols}else{if(h.sheet.max&&h.sheet.max<=s.cols+W){if(!y.isBusy()){y.trigger("alert",[y.msg.maxColsBrowserLimitation])}return false}}}I={el:function(){var Y=y.rowTds(U,1)[R],ab=y.rowTds(U),ac=ab[ab.length-1],aa=y.getTdLocation(ac),Z=[];for(var X=0;X<=aa.row;X++){Z.push(U.tBody.children[X].children[R])}return Z},col:function(){return y.col(U,R)},cols:[],newCol:function(){var X=o.createElement("col");X.setAttribute("style","width:"+y.s.newColumnWidth+"px;");I.cols.push(X);return X},loc:function(X){X=(X?X:I.el());return y.getTdLocation(X[0])},tds:[],newObj:function(){var X=o.createElement("td");I.tds.push(X);return X},offset:{row:0,col:W},start:function(){return{col:(P?R:R+W)}},createCells:function(){var Z=y.rows(U);for(var ab=0;ab<Z.length;ab++){var Y=(P?0:1)+R,ad=Y+W,X=0;for(Y;Y<ad;Y++){var ac=U.tBody.children[ab].children[Y],aa=h(ac);if(ab==0){y.controls.bar.x.td[y.i].splice(Y,0,aa);ac.innerText=d.columnLabelString(Y);ac.className=y.cl.barTop+" "+y.cl.uiBar;ac.type="bar";ac.entity="top";I.cols[X].setAttribute("style","width:"+y.s.newColumnWidth+"px;");I.cols[X].bar=ac;X++}else{y.spreadsheets[y.i][ab].splice(Y,0,{});y.createCell(y.i,ab,Y)}}}y.refreshColumnLabels(R)}};break}var u=I.el(),S=I.loc(u),K,O=u.length-1,M;if(P){do{M=W-1;do{u[O].parentNode.insertBefore(I.newObj(),u[O])}while(M--)}while(O--);if(I.newCol){K=I.col();M=W-1;do{K.parentNode.insertBefore(I.newCol(),K)}while(M--)}}else{do{M=W-1;do{z(I.newObj(),u[O])}while(M--)}while(O--);if(I.newCol){K=I.col();M=W-1;do{z(I.newCol(),K)}while(M--)}}I.createCells();if(!L&&Q!=true){y.offsetFormulas(S,I.offset,P)}y.obj.pane().resizeScroll();if(N&&N[0]&&N[0].cellIndex&&N[0].parentNode){y.colLast=N[0].cellIndex;y.rowLast=N[0].parentNode.rowIndex}return true},addRow:function(u,s){y.controlFactory.addCells(u,s,1,"row");y.trigger("sheetAddRow",[u,s,1])},addColumn:function(u,s){y.controlFactory.addCells(u,s,1,"col");y.trigger("sheetAddColumn",[u,s,1])},barLeft:function(u){var I=u.tBody.children,s=I.length-1;if(s>-1){do{I[s].insertBefore(o.createElement("td"),I[s].children[0])}while(s-->1)}},barTop:function(P){var s=P.colGroup,O=s.children,L,u=P.tBody.children[0],N=o.createElement("col"),K=o.createElement("td"),M=o.createElement("tr");while(O.length>u.children.length){s.removeChild(O[O.length-1])}N.width=J.colMargin+"px";N.style.width=N.width;s.insertBefore(N,s.children[0]);M.appendChild(K);M.className=y.cl.barTopParent;P.tBody.insertBefore(M,P.tBody.children[0]);P.barTopParent=M;P.corner=K;y.controls.barTopParent[y.i]=h(M);L=u.children.length-1;do{var I=o.createElement("td");if(!O[L]){O[L]=o.createElement("col");s.insertBefore(O[L],N.nextSibling)}O[L].bar=I;I.col=O[L];M.insertBefore(I,K.nextSibling)}while(L-->0);P.barTop=y.controls.barTopParent[y.i].children();return M},barHandleFreeze:{top:function(I){if(y.isBusy()){return false}var Q=y.frozenAt(),s=y.scrolledTo();if(!(s.end.col<=Q.col+1)){return false}y.obj.barHelper().remove();var N=y.obj.barTop(Q.col+1),O=N.position(),P,K=h(I).offset(),M=o.createElement("div"),u=I.freezeHandleTop=h(M).appendTo(I).addClass(y.cl.uiBarHandleFreezeTop+" "+y.cl.barHelper+" "+y.cl.barHandleFreezeTop).height(N.height()).css("left",(O.left-M.clientWidth)+"px").attr("title",y.msg.dragToFreezeCol),L=I.table.barTop;y.controls.bar.helper[y.i]=y.obj.barHelper().add(M);y.controls.bar.x.handleFreeze[y.i]=u;y.draggable(u,{axis:"x",start:function(){y.setBusy(true);P=h(o.createElement("div")).appendTo(I).css("position","absolute").addClass("ui-state-highlight "+y.cl.barHelper).height(I.table.corner.clientHeight).fadeTo(0,0.33)},drag:function(){var R=y.nearest(u,L).prev();if(R.length&&R.position){P.width(R.position().left+R.width())}},stop:function(T,R){P.remove();y.setBusy(false);y.setDirty(true);var S=y.nearest(u,L);y.obj.barHelper().remove();y.scrolledTo().end.col=y.frozenAt().col=y.getTdLocation(S).col-1;y.evt.scroll.start("x",I)},containment:[K.left,K.top,C.min(K.left+I.table.clientWidth,K.left+I.clientWidth-j.scrollBarSize.width),K.top]});return true},left:function(I){if(y.isBusy()){return false}var Q=y.frozenAt(),s=y.scrolledTo();if(!(s.end.row<=(Q.row+1))){return false}y.obj.barHelper().remove();var N=h(I.table.tBody.children[Q.row+1].children[0]),O=N.position(),P,K=h(I).offset(),M=o.createElement("div"),u=I.freezeHandleLeft=h(M).appendTo(I).addClass(y.cl.uiBarHandleFreezeLeft+" "+y.cl.barHelper+" "+y.cl.barHandleFreezeLeft).width(N.width()).css("top",(O.top-M.clientHeight)+"px").attr("title",y.msg.dragToFreezeRow),L=h(I.table.tBody.children);y.controls.bar.helper[y.i]=y.obj.barHelper().add(M);y.controls.bar.y.handleFreeze[y.i]=u;y.draggable(u,{axis:"y",start:function(){y.setBusy(true);P=h(o.createElement("div")).appendTo(I).css("position","absolute").addClass("ui-state-highlight "+y.cl.barHelper).width(M.clientWidth).fadeTo(0,0.33)},drag:function(){var R=y.nearest(u,L).prev();if(R.length&&R.position){P.height(R.position().top+R.height())}},stop:function(T,R){P.remove();y.setBusy(false);y.setDirty(true);var S=y.nearest(u,L);y.obj.barHelper().remove();y.scrolledTo().end.row=y.frozenAt().row=C.max(y.getTdLocation(S.children(0)).row-1,0);y.evt.scroll.start("y",I)},containment:[K.left,K.top,K.left,C.min(K.top+I.table.clientHeight,K.top+I.clientHeight-j.scrollBarSize.height)]});return true},corner:function(){}},menu:function(I,s){var L,u=h([]);switch(I){case"top":L=h(o.createElement("div")).addClass(y.cl.uiMenu+" "+y.cl.tdMenu);y.controls.bar.x.menu[y.i]=L;break;case"left":L=h(o.createElement("div")).addClass(y.cl.uiMenu+" "+y.cl.tdMenu);y.controls.bar.y.menu[y.i]=L;break;case"cell":L=h(o.createElement("div")).addClass(y.cl.uiMenu+" "+y.cl.tdMenu);y.controls.tdMenu[y.i]=L;break}y.controls.menus[y.i]=y.obj.menus().add(L);L.mouseleave(function(){L.hide()}).bind("contextmenu",function(){return false}).appendTo(w).hide().disableSelectionSpecial();for(var K in s){if(s[K]){if(h.isFunction(s[K])){u.pushStack(h(o.createElement("div")).text(K).data("msg",K).click(function(){s[h(this).data("msg")].call(this,y);L.hide();return false}).appendTo(L).hover(function(){u.removeClass("ui-state-highlight");h(this).addClass("ui-state-highlight")},function(){h(this).removeClass("ui-state-highlight")}))}else{if(s[K]=="line"){h(o.createElement("hr")).appendTo(L)}}}}return L},barMenu:{top:function(I,s,u){if(y.isBusy()){return false}var L=y.obj.barMenuTop().hide();if(!L.length){L=y.controlFactory.menu("top",J.contextmenuTop)}y.obj.menus().hide();if(!u){L.css("left",(I.pageX-5)+"px").css("top",(I.pageY-5)+"px").show();return L}var K=y.obj.barMenuParentTop().hide();if(!K.length){K=h(o.createElement("div")).addClass(y.cl.uiBarMenuTop+" "+y.cl.barHelper+" "+y.cl.barTopMenuButton).append(h(o.createElement("span")).addClass("ui-icon ui-icon-triangle-1-s")).mousedown(function(M){K.parent().mousedown().mouseup();var N=K.offset();L.css("left",(M.pageX-5)+"px").css("top",(M.pageY-5)+"px").show()}).blur(function(){if(L){L.hide()}}).bind("destroy",function(){K.remove();y.controls.bar.x.menuParent[y.i]=null});y.controls.bar.x.menuParent[y.i]=K}K.prependTo(u).show()},left:function(u,s){if(y.isBusy()){return false}y.obj.barMenuLeft().hide();if(s){y.obj.barHandleFreezeLeft().remove()}var I;I=y.obj.barMenuLeft();if(!I.length){I=y.controlFactory.menu("left",J.contextmenuLeft)}y.obj.menus().hide();I.css("left",(u.pageX-5)+"px").css("top",(u.pageY-5)+"px").show();return true},corner:function(){}},tdMenu:function(s){if(y.isBusy()){return false}y.obj.tdMenu().hide();var u=y.obj.tdMenu();if(!u.length){u=y.controlFactory.menu("cell",J.contextmenuCell)}y.obj.menus().hide();u.css("left",(s.pageX-5)+"px").css("top",(s.pageY-5)+"px").show();return true},header:function(){y.obj.header().remove();y.obj.tabContainer().remove();var P=o.createElement("div"),I=o.createElement("table"),M=o.createElement("tr"),S,K,T=o.createElement("td"),U,L,u,Q,s;P.appendChild(I);I.appendChild(M);P.className=y.cl.header+" "+y.cl.uiControl;y.controls.header=h(P);if(J.title){if(h.isFunction(J.title)){J.title=y.title(y,D)}T.className=y.cl.title;y.controls.title=h(T).html(J.title)}else{h(T).hide()}M.appendChild(T);function R(W){if(h.isFunction(W)){W=h(W.call(y))}else{W=h(W)}if(W.is("ul")){W.find("ul").hide().addClass(y.cl.uiMenuUl);W.find("li").addClass(y.cl.uiMenuLi).hover(function(){h(this).find("ul:first").hide().show()},function(){h(this).find("ul:first").hide()})}return W}if(y.isSheetEditable()){if(J.menuLeft){L=o.createElement("td");L.className=y.cl.menu+" "+y.cl.menuFixed;M.insertBefore(L,T);y.controls.menuLeft[y.i]=h(L).append(R(J.menuLeft));y.controls.menuLeft[y.i].find("img").load(function(){y.sheetSyncSize()})}if(J.menuRight){u=o.createElement("td");u.className=y.cl.menu+" "+y.cl.menuFixed;M.appendChild(u);y.controls.menuRight[y.i]=h(u).append(R(J.menuRight));y.controls.menuRight[y.i].find("img").load(function(){y.sheetSyncSize()})}U=o.createElement("td");U.className=y.cl.label;y.controls.label=h(U);Q=o.createElement("textarea");Q.className=y.cl.formula;Q.onkeydown=y.evt.formula.keydown;Q.onkeyup=function(){y.obj.inPlaceEdit().value=this.value};Q.onchange=function(){y.obj.inPlaceEdit().value=this.value};Q.onpaste=y.evt.pasteOverCells;Q.onfocus=function(){y.setNav(false)};Q.onfocusout=function(){y.setNav(true)};Q.onblur=function(){y.setNav(true)};y.controls.formula=h(Q);var O=o.createElement("span");O.appendChild(Q);S=o.createElement("table");K=o.createElement("tr");S.appendChild(K);P.appendChild(S);s=o.createElement("td");s.className=y.cl.formulaParent;s.appendChild(O);K.appendChild(U);K.appendChild(s);y.resizableSheet(h(O),{minHeight:y.controls.formula.height(),maxHeight:78,handles:"s",resize:function(X,W){y.controls.formula.height(W.size.height)},stop:function(){y.sheetSyncSize()}});var V=h.sheet.instance;for(var N=0;N<V.length;N++){(V||{}).nav=false}y.setNav(true);o.onkeydown=y.evt.doc.keydown}return P},ui:function(){var s=o.createElement("div");s.setAttribute("class",y.cl.ui);y.controls.ui=h(s);return s},tabContainer:function(){var s=y.controls.tabContainer=h(o.createElement("span")).addClass(y.cl.tabContainer).mousedown(function(L){var K=L.target.i;if(K>=0){y.trigger("sheetSwitch",[K])}return false}).dblclick(function(L){var K=L.target.i;if(K>=0){y.trigger("sheetRename",[K])}return false});if(y.isSheetEditable()){var u=o.createElement("span");u.setAttribute("class",y.cl.tab+" "+y.cl.uiTab+" ui-corner-bottom");u.setAttribute("title",y.msg.addSheet);u.innerHTML="&nbsp;+&nbsp;";u.onmousedown=function(){y.addSheet();return false};u.i=-1;s=s.add(u);if(h.fn.sortable){var I;s.sortable({placeholder:"ui-state-highlight",axis:"x",forceHelperSize:true,forcePlaceholderSize:true,opacity:0.6,start:function(L,K){I=K.item.index();y.trigger("sheetTabSortStart",[L,K])},update:function(L,K){y.trigger("sheetTabSortUpdate",[L,K,I])}})}}else{s.append(o.createElement("span"))}return s},scrollUI:function(S,L,U){var O=L.scrollOuter=o.createElement("div"),Q=L.scrollInner=o.createElement("div"),M=L.scrollStyleX=o.createElement("style"),K=L.scrollStyleY=o.createElement("style"),I=h(L);O.setAttribute("class",y.cl.scroll);O.appendChild(Q);O.onscroll=function(){if(!y.isBusy()){y.evt.scroll.scrollTo({axis:"x",pixel:O.scrollLeft});y.evt.scroll.scrollTo({axis:"y",pixel:O.scrollTop});y.autoFillerGoToTd();if(L.inPlaceEdit){L.inPlaceEdit.goToTd()}}};O.onmousedown=function(){y.obj.barHelper().remove()};y.controls.scroll[y.i]=h(O).disableSelectionSpecial();y.controls.scrolls=y.obj.scrolls().add(O);M.updateStyle=function(X,Y){X=X||[];if(X.length!=this.i||Y){this.i=X.length||this.i;Y=Y||H.nthCss("col","#"+y.id+y.i,X,y.frozenAt().col+1)+H.nthCss("td","#"+y.id+y.i+" tr",X,y.frozenAt().col+1);this.css(Y);y.scrolledTo();if(X.length){y.scrolledArea[y.i].start.col=C.max(X.pop()||1,1);y.scrolledArea[y.i].end.col=C.max(X.shift()||1,1)}y.obj.barHelper().remove()}};K.updateStyle=function(X,Y){X=X||[];if(X.length!=this.i||Y){this.i=X.length||this.i;Y=Y||H.nthCss("tr","#"+y.id+y.i,X,y.frozenAt().row+1);this.css(Y);y.scrolledTo();if(X.length){y.scrolledArea[y.i].start.row=C.max(X.pop()||1,1);y.scrolledArea[y.i].end.row=C.max(X.shift()||1,1)}y.obj.barHelper().remove()}};L.appendChild(M);L.appendChild(K);y.controlFactory.styleUpdater(M);y.controlFactory.styleUpdater(K);y.controls.bar.x.scroll[y.i]=M;y.controls.bar.y.scroll[y.i]=K;var T,W,R,N,u,s,P=U.tBody.children[0];L.resizeScroll=function(X){if(X){T=M.styleString();W=K.styleString()}else{T=(U.clientWidth<=S.clientWidth?"":M.styleString());W=(U.clientHeight<=S.clientHeight?"":K.styleString())}M.updateStyle(null," ");K.updateStyle(null," ");R=(P.clientWidth||U.clientWidth)+"px";N=U.clientHeight+"px";u=S.clientWidth+"px";s=S.clientHeight+"px";Q.style.width=R;Q.style.height=N;O.style.width=u;O.style.height=s;y.evt.scroll.start("x",L);y.evt.scroll.start("y",L);M.updateStyle(null,T);K.updateStyle(null,W);if(L.inPlaceEdit){L.inPlaceEdit.goToTd()}};var V=function(Z){Z=Z||j.event;var X;if("mousewheel"==Z.type){var aa=function(ac,ab){return 0!=ac%ab?ac:ac/ab},Y=1;if(Z.wheelDeltaX!==G){X=function(ab){ab=ab||j.event;O.scrollTop+=aa(-ab.wheelDeltaY,Y);O.scrollLeft+=aa(-ab.wheelDeltaX,Y);return false}}else{X=function(ab){ab=ab||j.event;O.scrollTop+=aa(-ab.wheelDelta,Y);return false}}}else{X=function(ad){if(this.detail=(ad.detail||ad.deltaX||ad.deltaY)){(9<this.detail?this.detail=3:-9>this.detail&&(this.detail=-3));var ac=0,ab=0;switch(this.detail){case 1:case -1:ab=this.detail*50;break;case 3:case -3:ac=this.detail*15;break}O.scrollTop+=ac;O.scrollLeft+=ab}return false}}I.mousewheel(X);return false};I.mousewheel(V);return O},styleUpdater:function(s){if(s.styleSheet){s.css=function(u){this.styleSheet.disabled=false;if(!this.styleSheet.disabled){this.styleSheet.cssText=u}};s.touch=function(){};s.styleString=function(){this.styleSheet.disabled=false;if(!this.styleSheet.disabled){return this.styleSheet.cssText}return""}}else{s.css=function(u){this.innerHTML=u};s.touch=function(){this.innerHTML=this.innerHTML+" "};s.styleString=function(){return this.innerHTML}}},hide:function(M,O,I){O=O||y.obj.pane();var s=o.createElement("style"),N=o.createElement("style"),L,K,u;s.updateStyle=function(Q){var P=H.nthCss("col","#"+y.id+y.i,y.toggleHide.hiddenColumns[y.i],0)+H.nthCss("td","#"+y.id+y.i+" tr",y.toggleHide.hiddenColumns[y.i],0);this.css(P);y.autoFillerGoToTd()};N.updateStyle=function(Q){var P=H.nthCss("tr","#"+y.id+y.i,y.toggleHide.hiddenRows[y.i],0);this.css(P);y.autoFillerGoToTd()};y.controls.toggleHide.x[y.i]=h(s);y.controls.toggleHide.y[y.i]=h(N);O.appendChild(s);O.appendChild(N);y.controlFactory.styleUpdater(s);y.controlFactory.styleUpdater(N);J.hiddenColumns[y.i]=J.hiddenColumns[y.i]||[];J.hiddenRows[y.i]=J.hiddenRows[y.i]||[];if(!J.hiddenColumns[y.i].length||!J.hiddenRows[y.i].length){L=I.attributes["data-hiddenrows"]||{value:""};K=I.attributes["data-hiddencolumns"]||{value:""};J.hiddenRows[y.i]=f.toNumbers(L.value.split(","));J.hiddenColumns[y.i]=f.toNumbers(K.value.split(","))}if(y.s.hiddenRows[y.i]){u=y.s.hiddenRows[y.i].length-1;if(u>-1){do{y.toggleHide.row(y.s.hiddenRows[y.i][u])}while(u--)}}if(J.hiddenColumns[y.i]){u=J.hiddenColumns[y.i].length-1;if(u>-1){do{y.toggleHide.column(J.hiddenColumns[y.i][u])}while(u--)}}},sheetUI:function(N,O,I){y.i=I;y.tuneTableForSheetUse(O);y.readOnly[I]=(O.className||"").match(/\breadonly\b/i)!=null;var K=y.controlFactory.enclosure(O),u=K.pane,s=h(u),L=function(S){S=S||j.event;if(y.isBusy()){return false}if(y.isBar(S.target)){var Q=S.target.entity,R=y.getBarIndex[Q](S.target);if(R<0){return false}if(y.evt.barInteraction.first==y.evt.barInteraction.last){y.controlFactory.barMenu[Q](S,R)}}else{y.controlFactory.tdMenu(S)}return false};N.appendChild(K);y.controlFactory.barTop(O);y.controlFactory.barLeft(O);u.appendChild(O);if(y.isSheetEditable()){y.controlFactory.autoFiller(u)}y.sheetTab(true);if(y.isSheetEditable()){var M=y.obj.formula(),P="";s.mousedown(function(Q){y.setNav(true);if(y.isBusy()){return false}if(y.isCell(Q.target)){if(Q.button==2){L.call(this,Q);y.evt.cellOnMouseDown(Q);return true}y.evt.cellOnMouseDown(Q);return false}if(y.isBar(Q.target)){if(Q.button==2){L.call(this,Q)}P=Q.target.entity;y.evt.barInteraction.select(Q.target);return false}return true});u.onmouseup=function(){P=""};u.onmouseover=function(T){T=T||j.event;T.target=T.target||T.srcElement;if(y.isBusy()){return false}if(!y.isBar(T.target)){return false}var S=h(T.target),Q=T.target.entity,R=y.getBarIndex[Q](T.target);if(R<0){return false}if(y.evt.barInteraction.selecting&&Q==P){y.evt.barInteraction.last=R;y.cellSetActiveBar(Q,y.evt.barInteraction.first,y.evt.barInteraction.last)}else{y.resizeBar[Q](S,R,u,O);if(y.isSheetEditable()){y.controlFactory.barHandleFreeze[Q](u);if(Q=="top"){y.controlFactory.barMenu[Q](T,R,S)}}}return true};u.ondblclick=y.evt.cellOnDblClick;s.bind("contextmenu",L).disableSelectionSpecial().bind("cellEdit",y.evt.cellEdit)}y.themeRoller.start(O);y.createSpreadsheet(O,I);y.checkMinSize(O);y.controlFactory.tab();y.controlFactory.hide(K,u,O);y.setChanged(true)},enclosure:function(u){var K=o.createElement("div"),I=o.createElement("div"),s=h(I);I.scrollUI=y.controlFactory.scrollUI(I,K,u);I.appendChild(I.scrollUI);K.setAttribute("class",y.cl.pane+" "+y.cl.uiPane);I.appendChild(K);I.setAttribute("class",y.cl.enclosure);I.pane=K;I.table=u;K.table=u;K.enclosure=I;u.pane=K;u.enclosure=I;y.controls.pane[y.i]=K;y.controls.panes=y.obj.panes().add(K);y.controls.enclosure[y.i]=s;y.controls.enclosures=y.obj.enclosures().add(I);return I},tab:function(){var s=o.createElement("span"),u=y.controls.tab[y.i]=h(s).appendTo(y.obj.tabContainer());s.setAttribute("class",y.cl.tab);s.innerHTML=y.sheetTab(true);s.i=y.i;s.setAttribute("class",y.cl.uiTab+" ui-corner-bottom");y.controls.tabs=y.obj.tabs().add(u);return s},inPlaceEdit:function(N,u){N=N||y.obj.tdActive();if(!N.length){N=h(y.rowTds(null,1)[1]);y.cellEdit(N)}if(!N.length){return}(y.obj.inPlaceEdit().destroy||E)();var M=y.obj.formula(),I=M.val(),s,L,K=y.obj.pane();if(!N[0].isHighlighted){return}s=o.createElement("textarea");L=h(s);K.inPlaceEdit=s;s.i=y.i;s.value=M[0].value;s.className=y.cl.inPlaceEdit+" "+y.cl.uiInPlaceEdit;s.td=N[0];s.goToTd=function(){this.offset=N.offset();if(!this.offset.left&&!this.offset.right){h(s).hide()}else{this.setAttribute("style","left:"+(this.offset.left-1)+"px;top:"+(this.offset.top-1)+"px;width:"+this.td.clientWidth+"px;height:"+this.td.clientHeight+"px;min-width:"+this.td.clientWidth+"px;min-height:"+this.td.clientHeight+"px;")}};s.goToTd();s.onkeydown=y.evt.inPlaceEdit.keydown;s.onchange=s.onkeyup=function(){M[0].value=s.value};s.onfocus=function(){y.setNav(false)};s.onblur=s.onfocusout=function(){y.setNav(true)};s.onpaste=y.evt.pasteOverCells;s.destroy=function(){K.inPlaceEdit=null;y.cellLast.isEdit=(s.value!=I);s.parentNode.removeChild(s);y.controls.inPlaceEdit[s.i]=false};A.appendChild(s);s.onfocus();y.controls.inPlaceEdit[y.i]=s;if(!u){L.select()}if(h.fn.elastic){h(s).elastic()}},autoFiller:function(K){if(!J.autoFiller){return false}var u=o.createElement("div"),s=o.createElement("div"),I=o.createElement("div");u.i=y.i;u.className=y.cl.autoFiller+" "+y.cl.uiAutoFiller;s.className=y.cl.autoFillerHandle;I.className=y.cl.autoFillerCover;u.onmousedown=function(){var M=y.obj.tdActive();if(M){var L=y.getTdLocation(M);y.cellSetActive(M,L,true,y.autoFillerNotGroup,function(){var O=y.highlighted(),N=y.getTdLocation(O.last());y.fillUpOrDown(N.row<L.row||N.col<L.col);y.autoFillerGoToTd(M);y.autoFillerNotGroup=false})}};K.autoFiller=y.controls.autoFiller[y.i]=h(u);K.appendChild(u);return true}},autoFillerNotGroup:true,updateCellsAfterPasteToFormula:function(Q){var P=0,O=y.obj.formula(),S=new l();Q=Q||O.val();var N={row:y.cellLast.row,col:y.cellLast.col},u=O.val(),K=u;if(N.row==0&&N.col==0){return false}var T=tsv.parse(u);if(!h.isArray(T)){O.val(T);y.fillUpOrDown(false,T);return true}for(var M=0;M<T.length;M++){y.cellLast.isEdit=true;var s=T[M];for(var L=0;L<s.length;L++){P++;var I=y.getTd(y.i,M+N.row,L+N.col);I.row=N.row;I.col=N.col;if(I.length){if(!y.spreadsheets[y.i]||!y.spreadsheets[y.i][M+N.row]||!y.spreadsheets[y.i][M+N.row][L+N.col]){continue}var R=y.spreadsheets[y.i][M+N.row][L+N.col];if(R){J.parent.one("sheetPreCalculation",function(){if((s[L]+"").charAt(0)=="="){R.formula=s[L].substring(1);R.value="";I.data("formula",s[L])}else{R.formula="";R.value=s[L];I.removeData("formula")}});y.calcDependencies.call(R);if(M==0&&L==0){K=s[L]}}}}}if(u!=K){O.val(K)}y.fillUpOrDown(false,K);y.evt.cellEditDone(true);return true},evt:{inPlaceEdit:{enter:function(s){if(s.shiftKey){return true}return y.evt.cellSetActiveFromKeyCode(s,true)},tab:function(s){if(s.shiftKey){return true}return y.evt.cellSetActiveFromKeyCode(s,true)},keydown:function(s){s=s||j.event;y.trigger("sheetFormulaKeydown",[true]);switch(s.keyCode){case p.ENTER:return y.evt.inPlaceEdit.enter(s);break;case p.TAB:return y.evt.inPlaceEdit.tab(s);break;case p.ESCAPE:y.evt.cellEditAbandon();return false;break}}},formula:{keydown:function(s){s=s||j.event;if(y.readOnly[y.i]){return false}if(y.cellLast.row<0||y.cellLast.col<0){return false}y.trigger("sheetFormulaKeydown",[false]);switch(s.keyCode){case p.C:if(s.ctrlKey){return y.evt.doc.copy(s)}else{y.obj.tdActive().dblclick();return true}case p.X:if(s.ctrlKey){return y.evt.doc.cut(s)}else{y.obj.tdActive().dblclick();return true}case p.Y:if(s.ctrlKey){y.evt.doc.redo(s);return false}else{y.obj.tdActive().trigger("cellEdit");return true}break;case p.Z:if(s.ctrlKey){y.evt.doc.undo(s);return false}else{y.obj.tdActive().trigger("cellEdit");return true}break;case p.ESCAPE:y.evt.cellEditAbandon();break;case p.ENTER:y.evt.cellSetActiveFromKeyCode(s,true);return false;break;default:y.cellLast.isEdit=true}},If:function(u,s){if(u){y.obj.tdActive().dblclick();return true}return false}},doc:{enter:function(s){if(!y.cellLast.isEdit&&!s.ctrlKey){y.obj.tdActive().dblclick()}return false},tab:function(s){y.evt.cellSetActiveFromKeyCode(s)},findCell:function(s){if(s.ctrlKey){y.cellFind();return false}return true},redo:function(s){if(s.ctrlKey&&!y.cellLast.isEdit){y.undo.manager.redo();return false}return true},undo:function(s){if(s.ctrlKey&&!y.cellLast.isEdit){y.undo.manager.undo();return false}return true},copy:function(L,u){var K=y.highlighted(true),M=y.obj.formula(),I=M.val(),s=y.toTsv(K,u);M.val(s).focus().select();x.one("keyup",function(){if(u){M.val("")}else{M.val(I)}});return true},cut:function(s){return this.copy(s,true)},pageUpDown:function(s){var K=y.sheetSize(),O=y.obj.pane(),I=O.clientHeight,L=0,M=0,N,u;if(s){for(u=y.cellLast.row;u>0&&L<I;u--){N=y.getTd(y.i,u,1);if(!N.data("hidden")&&N.is(":hidden")){N.show()}L+=N.parent().height()}}else{for(u=y.cellLast.row;u<K.rows&&L<I;u++){N=y.getTd(y.i,u,1);L+=N.parent().height()}}y.cellEdit(N);return false},keydown:function(s){s=s||j.event;if(y.readOnly[y.i]){return false}if(y.cellLast.row<0||y.cellLast.col<0){return false}var u=y.cellLast.td;if(y.nav){switch(s.keyCode){case p.DELETE:y.toTsv(null,true);y.obj.formula().val("");break;case p.TAB:y.evt.doc.tab(s);break;case p.ENTER:y.evt.cellSetActiveFromKeyCode(s);break;case p.LEFT:case p.UP:case p.RIGHT:case p.DOWN:(s.shiftKey?y.evt.cellSetHighlightFromKeyCode(s):y.evt.cellSetActiveFromKeyCode(s));break;case p.PAGE_UP:y.evt.doc.pageUpDown(true);break;case p.PAGE_DOWN:y.evt.doc.pageUpDown();break;case p.HOME:case p.END:y.evt.cellSetActiveFromKeyCode(s);break;case p.V:if(s.ctrlKey){return y.evt.formula.If(!y.evt.pasteOverCells(s),s)}else{u.trigger("cellEdit");return true}break;case p.Y:if(s.ctrlKey){y.evt.doc.redo(s);return false}else{u.trigger("cellEdit");return true}break;case p.Z:if(s.ctrlKey){y.evt.doc.undo(s);return false}else{u.trigger("cellEdit");return true}break;case p.ESCAPE:y.evt.cellEditAbandon();break;case p.F:if(s.ctrlKey){return y.evt.formula.If(y.evt.doc.findCell(s),s)}else{u.trigger("cellEdit");return true}break;case p.CAPS_LOCK:case p.SHIFT:case p.ALT:break;case p.CONTROL:y.obj.formula().focus().select();return true;break;default:u.trigger("cellEdit");return true;break}return false}}},pasteOverCells:function(I){I=I||j.event;if(I.ctrlKey||I.type=="paste"){var u=function(){y.updateCellsAfterPasteToFormula()};var s=x.one("keyup",function(){u();u=function(){};s.mouseup()}).one("mouseup",function(){u();u=function(){};s.keyup()});y.setDirty(true);y.setChanged(true);return true}return false},cellEditDone:function(I){(y.obj.inPlaceEdit().destroy||E)();if(y.cellLast.isEdit||I){var L=y.obj.formula(),K=y.obj.tdActive();if(y.isFormulaEditable(K)){if(K&&y.cellLast.row>0&&y.cellLast.col>0){var u=L.val(),s=K[0].jSCell;if(!s.edited){s.edited=true;y.controls.cellsEdited[y.i]=y.obj.cellsEdited().add(s)}J.parent.one("sheetPreCalculation",function(){if(u.charAt(0)=="="&&y.formulaParser){K.data("formula",u);s.value=u;s.formula=u}else{K.removeData("formula");s.value=u;s.formula=""}});y.calcDependencies.call(s);y.cellLast.isEdit=false;y.trigger("sheetCellEdited",[s])}}}},cellEditAbandon:function(s){(y.obj.inPlaceEdit().destroy||E)();y.themeRoller.bar.clearActive();y.themeRoller.cell.clearHighlighted(null,true);if(!s){y.calc()}y.cellLast.td=h([]);y.cellLast.row=0;y.cellLast.col=0;y.rowLast=0;y.colLast=0;y.highlightedLast.start={row:0,col:0};y.highlightedLast.end={row:0,col:0};y.labelUpdate("",true);y.obj.formula().val("").blur();y.autoFillerHide();return false},cellSetHighlightFromKeyCode:function(K){var I=y.highlightedLastOrdered(),u=y.sheetSize(),N=y.obj.tdActive(),L=y.getTdLocation(N),M=I.start,s=I.end;switch(K.keyCode){case p.UP:if(I.start.row<L.row){M.row=I.start.row;M.row--;M.row=C.max(M.row,1);break}s.row=I.end.row;s.row--;s.row=C.max(s.row,1);break;case p.DOWN:if(I.start.row<=M.row){M.row=I.start.row;M.row++;M.row=C.min(M.row,u.rows);break}s.row=I.end.row;s.row++;s.row=C.min(s.row,u.rows);break;case p.LEFT:if(I.start.col<L.col){M.col=I.start.col;M.col--;M.col=C.max(M.col,1);break}s.col=I.end.col;s.col--;s.col=C.max(s.col,1);break;case p.RIGHT:if(I.start.col<L.col){M.col=I.start.col;M.col++;M.col=C.min(M.col,u.cols);break}s.col=I.end.col;s.col++;s.col=C.min(s.col,u.cols);break}y.highlightedLast.start=M;y.highlightedLast.end=s;y.cycleCellArea(function(O){y.themeRoller.cell.setHighlighted(O.td)},M,s);return false},cellSetActiveFromKeyCode:function(L,s){var M={row:y.cellLast.row,col:y.cellLast.col},K=false,I,u=false;switch(L.keyCode){case p.UP:M.row--;break;case p.DOWN:M.row++;break;case p.LEFT:M.col--;break;case p.RIGHT:M.col++;break;case p.ENTER:M=y.evt.incrementAndStayInGrid(y.highlightedLastOrdered(),M,"row","col",L.shiftKey);K=true;I=y.highlighted();if(I.length>1){u=true}else{if(!s){M.row+=(L.shiftKey?-1:1)}if(J.autoAddCells&&M.row>y.sheetSize().rows){y.controlFactory.addRow()}}break;case p.TAB:M=y.evt.incrementAndStayInGrid(y.highlightedLastOrdered(),M,"col","row",L.shiftKey);K=true;I=y.highlighted();if(I.length>1){u=true}else{if(!s){M.col+=(L.shiftKey?-1:1)}if(J.autoAddCells&&M.col>y.sheetSize().cols){y.controlFactory.addColumn()}}break;case p.HOME:M.col=1;break;case p.END:M.col=y.obj.tdActive().parent().children("td").length-1;break}M.col=M.col||1;M.row=M.row||1;if(!y.cellLast.isEdit||K){var N=y.getTd(y.i,M.row,M.col);if(N){y.cellEdit(N,null,u);return false}}return true},incrementAndStayInGrid:function(K,L,u,s,I){if(I){L[u]--;if(L[u]<K.start[u]){L[u]=K.end[u];L[s]--}if(L[s]<K.start[s]){L[s]=K.end[s]}}else{L[u]++;if(L[u]>K.end[u]){L[u]=K.start[u];L[s]++}if(L[s]>K.end[s]){L[s]=K.start[s]}}return L},cellOnMouseDown:function(s){y.obj.formula().blur();if(s.shiftKey){y.getTdRange(s,y.obj.formula().val())}else{y.cellEdit(h(s.target),true)}},cellOnDblClick:function(s){if(y.isBusy()){return false}y.controlFactory.inPlaceEdit(null,true);return true},cellEdit:function(s){if(y.isBusy()){return false}y.controlFactory.inPlaceEdit();return true},barInteraction:{first:0,last:0,selecting:false,select:function(I){if(!I){return}if(!I.type=="bar"){return}var s=I.entity,u=y.getBarIndex[s](I);if(u<0){return false}y[s+"Last"]=u;y.evt.barInteraction.last=y.evt.barInteraction.first=u;y.cellSetActiveBar(s,y.evt.barInteraction.first,y.evt.barInteraction.last);y.evt.barInteraction.first=y.evt.barInteraction.last=y[s+"Last"]=u;y.evt.barInteraction.selecting=true;x.one("mouseup",function(){y.evt.barInteraction.selecting=false});return false}},scroll:{axis:{x:{},y:{}},size:{},td:{},start:function(M,N){y.autoFillerHide();N=N||y.obj.pane();var L=y.evt.scroll,I=N.scrollOuter,K=L.axis[M];L.size=y.sheetSize(N.table);L.td=y.obj.tdActive();K.v=[];K.name=M;switch(M||"x"){case"x":K.max=L.size.cols;K.min=0;K.size=L.size.cols;N.scrollStyleX.updateStyle();K.scrollStyle=N.scrollStyleX;K.area=I.scrollWidth-I.clientWidth;K.sheetArea=N.table.clientWidth-N.table.corner.clientWidth;K.scrollUpdate=function(){I.scrollLeft=(K.value)*(K.area/K.size)};K.gridSize=100/K.size;break;case"y":K.max=L.size.rows;K.min=0;K.size=L.size.rows;N.scrollStyleY.updateStyle();K.scrollStyle=N.scrollStyleY;K.area=I.scrollHeight-I.clientHeight;K.sheetArea=N.table.clientHeight-N.table.corner.clientHeight;K.scrollUpdate=function(){I.scrollTop=(K.value)*(K.area/K.size)};K.gridSize=100/K.size;break}var u=K.max;do{var s=new k(K.gridSize*u);s.index=u+1;K.v.unshift(s)}while(u--)},scrollTo:function(K){K=K||{};K.axis=K.axis||"x";K.value=K.value||0;K.pixel=K.pixel||0;if(!y.evt.scroll.axis){y.evt.scroll.start(K.axis)}var I=y.evt.scroll.axis[K.axis];if(!K.value){K.value=f.closest(I.v,C.abs(K.pixel/I.area)*100,I.min).index}K.max=K.max||I.max;var u=((K.value>K.max?K.max:K.value)-I.min),s=[];if(u>=0){do{s.push(u+I.min)}while(u-->0)}if(s.length){if(I.scrollStyle){I.scrollStyle.updateStyle(s)}}else{if(I.scrollStyle){I.scrollStyle.updateStyle()}}I.value=K.value},stop:function(){if(this.axis.x.scrollUpdate){this.axis.x.scrollUpdate()}if(this.axis.y.scrollUpdate){this.axis.y.scrollUpdate()}if(y.evt.scroll.td){y.evt.scroll.td=null;y.autoFillerGoToTd()}}}},refreshColumnLabels:function(I){I=I||0;y.obj.barMenuParentTop().trigger("destroy");var u=y.controls.bar.x.td[y.i];if(!u){return}for(var s=I;s<u.length;s++){if(s){u[s].text(d.columnLabelString(u[s][0].cellIndex))}}},refreshRowLabels:function(I){I=I||0;var u=y.controls.bar.y.td[y.i];if(!u){return}for(var s=I;s<u.length;s++){if(s){h(u[s]).text(u[s][0].parentNode.rowIndex)}}},isCell:function(s){if(s&&s.tagName&&s.tagName=="TD"&&s.type&&s.type=="cell"){return true}return false},isBar:function(s){if(s&&s.tagName&&s.tagName=="TD"&&s.type&&s.type=="bar"){return true}return false},readOnly:[],isSheetEditable:function(s){s=s||y.i;return(J.editable==true&&!y.readOnly[s])},isFormulaEditable:function(s){if(J.lockFormulas){if(s.data("formula")!==G){return false}}return true},toggleFullScreen:function(){if(!y){return}y.evt.cellEditDone();var I=y.obj.fullScreen(),M=y.obj.pane();if(I.is(":visible")){r.unbind("jSResize");w.removeClass("bodyNoScroll");J.parent=I[0].origParent;J.parent.prepend(I.children());I.remove();y.sheetSyncSize();M.resizeScroll();y.trigger("sheetFullScreen",[false])}else{w.addClass("bodyNoScroll");var K=h(J.parent),I=o.createElement("div"),u=h._data(J.parent[0],"events");I.className=y.cl.fullScreen+" "+y.cl.uiFullScreen+" "+y.cl.parent;I.origParent=K;J.parent=y.controls.fullScreen=h(I).append(K.children()).appendTo(w);r.bind("resize",function(){r.trigger("jSResize")}).bind("jSResize",function(){this.w=r.width();this.h=r.height();J.parent.width(this.w).height(this.h);y.sheetSyncSize();M.resizeScroll()}).trigger("jSResize");K.trigger("sheetFullScreen",[true]);for(var L in u){for(var s=0;s<u[L].length;s++){J.parent.bind(L,u[L][s].handler)}}}},renameSheet:function(s){if(v(s)){return false}if(s>-1){y.sheetTab()}return true},switchSheet:function(s){if(v(s)){return false}if(s==-1){y.addSheet()}else{if(s!=y.i){y.setActiveSheet(s);y.calc(s)}}return true},tuneTableForSheetUse:function(I){var u=h(I);y.controls.table[y.i]=u.addClass(y.cl.table).addClass(y.cl.uiTable).attr("id",y.id+y.i).attr("border","1px").attr("cellpadding","0").attr("cellspacing","0");y.formatTable(I);y.sheetDecorateRemove(false,u);y.controls.tables=y.obj.tables().add(I);var K=u.attr("data-frozenatrow")*1,s=u.attr("data-frozenatcol")*1;if(!y.s.frozenAt[y.i]){y.s.frozenAt[y.i]={row:0,col:0}}if(K){y.s.frozenAt[y.i].row=K}if(s){y.s.frozenAt[y.i].col=s}},createSpreadsheet:function(I,u){I.spreadsheet=y.spreadsheets[u]=[];var K=y.rows(I),L=K.length-1,s;if(L<0){return}do{s=K[L].children.length-1;if(s<0){return}do{var M=K[L].children[s];if(L>0&&s>0){y.createCell(u,L,s)}else{if(s==0&&L>0){M.type="bar";M.entity="left";M.innerHTML=L;M.className=y.cl.barLeft+" "+y.cl.barLeft+"_"+y.i+" "+y.cl.uiBar;M.setAttribute("style","height:"+M.nextSibling.style.height)}if(L==0&&s>0){M.type="bar";M.entity="top";M.innerHTML=d.columnLabelString(s);M.className=y.cl.barTop+" "+y.cl.barTop+"_"+y.i+" "+y.cl.uiBar}if(L==0&&s==0){M.type="bar";M.entity="corner";M.className=y.cl.uiBar+"  "+y.cl.barCorner;y.controls.bar.corner[y.i]=M}}}while(s--)}while(L--)},toggleHide:{hiddenRows:[],row:function(u){u=u||y.rowLast;if(!u){return}var K=y.rows()[u],s=h(K),I=[];if(!this.hiddenRows[y.i]){this.hiddenRows[y.i]=[]}if(s.length&&h.inArray(u+1,this.hiddenRows[y.i])<0){this.hiddenRows[y.i].push(u+1)}else{this.hiddenRows[y.i].splice(this.hiddenRows[y.i].indexOf(u+1),1)}y.obj.toggleHideStyleY()[0].updateStyle()},rowShowAll:function(){h.each(this.hiddenRows[y.i]||[],function(s){h(this).removeData("hidden")});y.obj.toggleHideStyleY().html("");this.hiddenRows[y.i]=[]},hiddenColumns:[],columnIndexOffset:[],column:function(u){u=u||y.colLast;if(!u){return}var s=y.cols()[u],K=h(s),I=[];if(!this.hiddenColumns[y.i]){this.hiddenColumns[y.i]=[]}if(K.length&&h.inArray(u+1,this.hiddenColumns[y.i])<0){this.hiddenColumns[y.i].push(u+1)}else{this.hiddenColumns[y.i].splice(this.hiddenColumns[y.i].indexOf(u+1),1)}y.obj.toggleHideStyleX()[0].updateStyle()},columnShowAll:function(){y.obj.toggleHideStyleX().html("");this.hiddenColumns[y.i]=[]}},merge:function(O){O=O||y.highlighted();if(!O.length){return}var M=[],u=O[0],L=O[O.length-1],T=y.getTdLocation(u),I=y.getTdLocation(L),W={},R={},Q=0,S=0,V=new l(),N=O.length-1,U,X,K,s,P;if(T.row){y.setDirty(true);y.setChanged(true);if(T.row<I.row){W.row=T.row;R.row=I.row;K=u}else{W.row=I.row;R.row=T.row;K=L}if(K.getAttribute("rowSpan")||K.getAttribute("colSpan")){return false}s=h(K);if(T.col<I.col){W.col=T.col;R.col=I.col}else{W.col=I.col;R.col=T.col}S=(R.row-W.row)+1;Q=(R.col-W.col)+1;P=y.getTdLocation(K);do{X=O[N];U=X.jSCell;if(U.formula||U.value){M.unshift(U.formula?"("+U.formula.substring(1)+")":U.value)}J.parent.one("sheetPreCalculation",function(){if(X.cellIndex!=P.col||X.parentNode.rowIndex!=P.row){U.formula=null;U.value="";U.html="";U.defer=K.jSCell;U.calcLast=V;X.removeAttribute("data-formula");X.removeAttribute("data-celltype");X.innerHTML="";X.style.display="none"}});y.calcDependencies.call(U)}while(N--);K.jSCell.value=M.join(" ");K.jSCell.formula=(K.jSCell.formula?M.join(" "):"");K.jSCell.calcLast=V;K.style.display="";K.setAttribute("rowSpan",S);K.setAttribute("colSpan",Q);y.calcDependencies.call(K.jSCell);y.evt.cellEditDone();y.autoFillerGoToTd(s);y.cellSetActive(s,P)}return true},unmerge:function(s){s=s||y.highlighted();if(!s){return}var I=s[0],N=y.getTdLocation(I),O=new l(),Q=C.max(I.getAttribute("rowSpan")*1,1)-1,u=C.max(I.getAttribute("colSpan")*1,1)-1,M=Q+N.row,K,P,L=[];if(Q==0&&u==0){return false}do{K=N.col+u;do{P=y.getTd(y.i,M,K)[0];P.style.display="";P.removeAttribute("colSpan");P.removeAttribute("rowSpan");P.jSCell.defer=null;y.calcDependencies.call(P.jSCell,O);L.push(P)}while(K-->N.col)}while(M-->N.row);y.evt.cellEditDone();y.autoFillerGoToTd(s);y.cellSetActive(s,N);y.themeRoller.cell.setHighlighted(h(L));return true},fillUpOrDown:function(O,Q,S){y.evt.cellEditDone();S=S||y.highlighted(true);if(S.length<1){return false}var L=y.obj.tdActive(),P=new l();if(S.length<1){return false}var M=y.getTdLocation(S[0].td),T=y.getTdLocation(S[S.length-1].td),s=y.getTdLocation(L),I={row:0,col:0},u=Q||L[0].jSCell.value,R=false,K=S.length-1,N=function(){};Q=Q||L[0].jSCell.value;if(K>=0){if(Q.charAt&&Q.charAt(0)=="="){if(K>=0){do{if(!O){I.row=s.row-T.row;I.col=s.col-T.col}else{I.row=s.row-M.row;I.col=s.col-M.col}u=y.reparseFormula(Q,I);J.parent.one("sheetPreCalculation",function(){S[K].formula=u;S[K].value="";S[K].td.data("formula",u)});y.calcDependencies.call(S[K],P)}while(K--);return true}}else{if((R=!v(u))||u.length>0){if(R&&u!=""){u*=1;if(O){u-=S.length-1}N=function(){u++}}}do{J.parent.one("sheetPreCalculation",function(){S[K].formula="";S[K].value=u+"";S[K].td.removeData("formula")});y.calcDependencies.call(S[K],P);N()}while(K--)}}return false},toTsv:function(S,K,Q){S=S||y.highlighted(true);if(S.type){S=[S]}Q=Q||function(V,U){if(K){J.parent.one("sheetPreCalculation",function(){U.formula="";U.value=""});y.calcDependencies.call(U,P)}};var N=[],R,M,u={},P=new l(),I=S.length-1,T,s;if(I>=0){R=y.getTdLocation(S[0].td);M=y.getTdLocation(S[S.length-1].td);u.row=C.min(R.row,M.row);u.col=C.min(R.col,M.col);do{var L=y.getTdLocation(S[I].td),O=(S[I].formula?"="+S[I].formula:S[I].value);T=C.abs(L.row-u.row);s=C.abs(L.col-u.col);if(!N[T]){N[T]=[]}if((O+="").match(/\n/)){O='"'+O+'"'}N[T][s]=(O||"");Q.call(S[I].td,L,S[I])}while(I-->0);I=N.length-1;do{N[I]=N[I].join("\t")}while(I-->0);return N.join("\n")}return""},offsetFormulas:function(O,N,I,M){var u=y.sheetSize(),L={first:{row:1,col:1},last:{row:u.rows,col:u.cols}},K=new l(),s=[];y.cycleCells(function(){var P=this;if(this.formula&&typeof this.formula=="string"&&y.isFormulaEditable(this.td)){this.formula=y.reparseFormula(this.formula,N,O,I,M);this.td.data("formula","="+this.formula)}s.push(function(){y.calcDependencies.call(P,K,true)})},L.first,L.last);while(s.length){s.pop()()}y.evt.cellEditDone()},reparseFormula:function(L,K,I,s,u){return L.replace(d.regEx.cell,function(N,O,S,T){if(O=="SHEET"){return N}K=K||{loc:0,row:0};var M={row:S*1,col:d.columnLabelIndex(O)},R,Q,P={row:S,col:O,use:false};if(I){if(u){if(s){if(M.col&&M.col==I.col-1){P.col="#REF!";P.use=true}if(M.row&&M.row==I.row-1){P.row="#REF!";P.use=true}if(M.col>=I.col){R=true}if(M.row>=I.row){Q=true}}else{if(I.col&&M.col==I.col){P.col="#REF!";P.use=true}if(I.row&&M.row==I.row){P.row="#REF!";P.use=true}if(I.col&&M.col>I.col){R=true}if(I.row&&M.row>I.row){Q=true}}if(P.use){return P.col+P.row}if(R){M.col+=K.col;return y.makeFormula(M)}if(Q){M.row+=K.row;return y.makeFormula(M)}}else{if(s){if(I.col&&M.col>=I.col){R=true}if(I.row&&M.row>=I.row){Q=true}}else{if(I.col&&M.col>I.col){R=true}if(I.row&&M.row>I.row){Q=true}}if(R){M.col+=K.col;return y.makeFormula(M)}if(Q){M.row+=K.row;return y.makeFormula(M)}}}else{return y.makeFormula(M,K)}return N})},makeFormula:function(u,s){s=h.extend({row:0,col:0},s);u.col+=s.col;u.row+=s.row;if(u.col<0){u.col=0}if(u.row<0){u.row=0}return d.parseCellName(u.col,u.row)},cycleCells:function(K,N,L,I){I=I||y.i;N=N||{row:1,col:1};if(!L){var u=y.sheetSize();L={row:u.rows,col:u.cols}}var M=L.row,s;if(M<N.row){return}do{s=L.col;do{K.call(y.spreadsheets[I][M][s],I,M,s)}while(s-->N.col)}while(M-->N.row)},cycleCellsAll:function(K){var L=y.i,I,u,s;for(I=0;I<=y.sheetCount;I++){y.i=I;u=y.sheetSize();s={row:u.rows,col:u.cols};y.cycleCells(K,{row:0,col:0},s,I)}y.i=L},cycleCellArea:function(O,R,L,K){var s={start:{},end:{}},N,Q,S,P,I=y.i,u={cell:[],td:[]},M=y.spreadsheets[I];if(K){s.start=R;s.end=L}else{s.start.row=C.max(C.min(R.row,L.row),1);s.start.col=C.max(C.min(R.col,L.col),1);s.end.row=C.max(R.row,L.row,1);s.end.col=C.max(R.col,L.col,1)}N=s.end.row;do{Q=s.end.col;S=M[N]||null;do{if(S){P=S[Q]||null;if(P){u.cell.push(P);u.td.push(P.td[0])}}}while(Q-->s.start.col)}while(N-->s.start.row);if(O){O(u)}},formatTable:function(T){var R=J.newColumnWidth,O=J.colMargin,I=T.children,M=I.length-1,L,K,Q,u,P,S,N;if(M>-1){do{switch(I[M].nodeName){case"TBODY":S=true;Q=I[M];break;case"COLGROUP":N=true;u=I[M];break}}while(M--)}else{var s=o.createElement("tr");s.appendChild(o.createElement("td"));T.appendChild(s);I=T.children}if(!Q){Q=o.createElement("tbody");do{Q.appendChild(I[0])}while(I.length)}if(!u||u.children.length<1){u=o.createElement("colgroup");T.appendChild(u);T.appendChild(Q);P=Q.children[0];for(M=0,L=P.children.length;M<L;M++){K=o.createElement("col");u.appendChild(K);K.style.width=R+"px"}for(M=0,L=Q.children.length;M<L;M++){Q.children[M].style.height=O+"px"}}T.tBody=Q;T.colGroup=u;T.removeAttribute("width");T.style.width=""},checkMinSize:function(K){var I=y.sheetSize(K),L=J.minSize.rows||0,s=J.minSize.cols||0,u=y.frozenAt();L=(u.row>L?u.row+1:L);s=(u.col>s?u.col+1:s);if(I.cols<s){y.controlFactory.addColumnMulti(null,s-I.cols)}if(I.rows<L){y.controlFactory.addRowMulti(null,L-I.rows)}},themeRoller:{start:function(s){y.obj.header().addClass(y.cl.uiControl);y.obj.label().addClass(y.cl.uiControl);y.obj.formula().addClass(y.cl.uiControlTextBox)},cell:{setHighlighted:function(K,I){var u,L=y.highlightedLast.obj,s=y.obj.scrollStyleX();if(L&&L.length&&!I){u=L.length-1;do{L[u].isHighlighted=false}while(u-->0)}if(K&&K.length>0){u=K.length-1;do{if(!K[u].isHighlighted){K[u].isHighlighted=true;if(!K[u].className.match(y.cl.uiTdHighlighted)){K[u].className+=" "+y.cl.uiTdHighlighted}}}while(u-->0)}if(I){y.highlightedLast.obj=y.highlightedLast.obj.add(K)}else{y.themeRoller.cell.clearHighlighted(L);if(K){y.highlightedLast.obj=K}}s.touch()},isHighlighted:function(){return(y.highlightedLast.obj.length?true:false)},clearHighlighted:function(I,u){if(y.themeRoller.cell.isHighlighted()){I=I||y.highlightedLast.obj;if(I&&I.length){var s=I.length-1;do{if(!I[s].isHighlighted||u){I[s].className=I[s].className.replace(y.cl.uiTdHighlighted,"");I[s].isHighlighted=false}}while(s-->0)}}y.highlightedLast.obj=h([])}},bar:{style:function(s){h(s).addClass(y.cl.uiBar)},setActive:function(s,u){switch(s){case"top":y.highlightedLast.barTop.removeClass(y.cl.uiBarHighlight);y.highlightedLast.barTop=h(u).addClass(y.cl.uiBarHighlight);break;case"left":y.highlightedLast.barLeft.removeClass(y.cl.uiBarHighlight);y.highlightedLast.barLeft=h(u).addClass(y.cl.uiBarHighlight);break}},clearActive:function(){y.highlightedLast.barLeft.removeClass(y.cl.uiBarHighlight);y.highlightedLast.barLeft=h([]);y.highlightedLast.barTop.removeClass(y.cl.uiBarHighlight);y.highlightedLast.barTop=h([])}},tab:{setActive:function(){this.clearActive();y.obj.tab().addClass(y.cl.uiTabActive)},clearActive:function(){y.obj.tabContainer().find("span."+y.cl.uiTabActive).removeClass(y.cl.uiTabActive)}}},resizable:function(u,s){if(!u.data("resizable")){u.resizable(s)}},frozenAt:function(){var s;if(!(s=y.s.frozenAt[y.i])){s={row:0,col:0}}s.row=C.max(s.row,0);s.col=C.max(s.col,0);return s},scrolledTo:function(){if(!y.scrolledArea[y.i]){var s=y.frozenAt();y.scrolledArea[y.i]={start:{row:C.max(s.row,1),col:C.max(s.col,1)},end:{row:C.max(s.row,1),col:C.max(s.col,1)}}}return y.scrolledArea[y.i]},busy:[],setBusy:function(s){if(s){y.busy.push(s)}else{y.busy.pop()}},isBusy:function(){return(y.busy.length>0)},draggable:function(u,s){if(!u.data("jSdraggable")){u.data("jSdraggable",true).draggable(s)}},nearest:function(u,s){return h(u).nearest(s)},resizeBar:{top:function(M,I,O,u){y.obj.barTopControls().remove();var K=o.createElement("div"),N=h(K).addClass(y.cl.barController+" ui-state-highlight").width(M.width()).height(0).prependTo(M),s,L;y.controls.bar.x.controls[y.i]=y.obj.barTopControls().add(N);y.resizableCells(N,{handles:"e",start:function(Q,P){y.autoFillerHide();y.setBusy(true);s=y.col(u,I);if(O.freezeHandleTop){O.freezeHandleTop.remove()}s.removeAttribute("width")},resize:function(Q,P){s.style.width=P.size.width+"px";if(O.inPlaceEdit){O.inPlaceEdit.goToTd()}},stop:function(Q,P){y.setBusy(false);O.resizeScroll();y.followMe();y.setDirty(true)},minWidth:32});L=K.children[0];L.style.height=M.outerHeight()+"px";L.style.position="absolute"},left:function(K,N,I,R){y.obj.barLeftControls().remove();var M=K.offset(),S=o.createElement("div"),P=h(S).addClass(y.cl.barController+" ui-state-highlight").prependTo(K).offset({top:M.top,left:M.left}),Q=K[0],L=K.next()[0],T=L.parentNode,u=o.createElement("div"),s=h(u).addClass("jSBarControllerChild").height(K.height()).prependTo(P),O;y.controls.bar.y.controls[y.i]=y.obj.barLeftControls().add(P);y.resizableCells(s,{handles:"s",start:function(){y.autoFillerHide();y.setBusy(true);if(I.freezeHandleLeft){I.freezeHandleLeft.remove()}T.removeAttribute("height");Q.removeAttribute("height");L.removeAttribute("height")},resize:function(V,U){S.style.height=L.style.height=Q.style.height=T.style.height=U.size.height+"px";if(I.inPlaceEdit){I.inPlaceEdit.goToTd()}},stop:function(V,U){y.setBusy(false);I.resizeScroll();y.followMe();y.setDirty(true)},minHeight:15});O=u.children[0];O.style.width=K.outerWidth()+"px";O.style.position="absolute"},corner:function(){}},sheetDecorateRemove:function(u,s){s=s||y.obj.tables();s=(u?s.clone():s);s.find("td."+y.cl.uiTdActive).removeClass(y.cl.uiTdActive);s.find("td."+y.cl.uiTdHighlighted).removeClass(y.cl.uiTdHighlighted);return s},labelUpdate:function(u,s){if(!s){u=d.parseCellName(u.col,u.row);if(u){y.obj.label().text(u)}}else{y.obj.label().text(u)}},cellEdit:function(N,K,I){if(y.cellLast.td.length<1){}y.autoFillerNotGroup=true;y.evt.cellEditDone();if(!N.length){return}var L=y.getTdLocation(N),s=N[0].jSCell,u;if(!s){return}y.trigger("sheetCellEdit",[s]);if(!N.is(y.cellLast.td)){y.followMe(N)}else{y.autoFillerGoToTd(N)}y.labelUpdate(L);if(s.formula){u="="+s.formula}else{u=s.value}var M=y.obj.formula().val(u).blur();y.cellSetActive(N,L,K,false,null,I)},cellSetActive:function(L,N,u,P,M,I){if(N.col!=G){y.cellLast.td=L;y.cellLast.row=y.rowLast=N.row;y.cellLast.col=y.colLast=N.col;if(!I){y.themeRoller.cell.setHighlighted(L);y.highlightedLast.start=N;y.highlightedLast.end=N}if(!L.length){return}y.themeRoller.bar.setActive("left",L[0].barLeft);y.themeRoller.bar.setActive("top",L[0].barTop);var O,Q;switch(J.cellSelectModel){case"excel":case"gdrive":O=function(){};Q=function(){};break;case"oo":O=function(R){if(y.isCell(R)){y.cellEdit(h(R))}};Q=function(){};break}if(u){var s={},K=y.obj.pane();s.last=N;K.onmousemove=function(T){T=T||j.event;T.target=T.target||T.srcElement;if(y.isBusy()){return false}var S=y.highlightedLast.end=y.getTdLocation(T.target),R=true;if(S.col<1||S.row<1||S.col==F||S.row==F){return false}if(P){R=false;if(N.col==S.col||N.row==S.row){R=true}}if((s.last.col!=S.col||s.last.row!=S.row)&&R){O(T.target);y.cycleCellArea(function(U){y.themeRoller.cell.setHighlighted(U.td)},N,S)}s.last=S;return true};o.onmouseup=function(){K.onmousemove=null;K.onmousemove=null;K.onmouseup=null;o.onmouseup=null;if(M){M()}}}}},colLast:0,rowLast:0,cellLast:{td:h([]),row:0,col:0,isEdit:false},highlightedLast:{obj:h([]),start:{row:0,col:0},end:{row:0,col:0},barLeft:h([]),barTop:h([])},highlightedLastOrdered:function(){var u=this.highlightedLast,s={start:{},end:{}};s.start.row=c.min(u.start.row,u.end.row);s.start.col=c.min(u.start.col,u.end.col);s.end.row=c.max(u.start.row,u.end.row);s.end.col=c.max(u.start.col,u.end.col);return s},cellStyleToggle:function(N,O,L){L=L||y.highlighted();if(L.length<1){return false}y.setDirty(true);var I,s,M=L.length-1,P=y.obj.cellsEdited(),u=y.controls.cellsEdited[y.i],K;if(M>=0){K=L[0].className.match(N);do{I=L[M];s=h(I);if(O){s.removeClass(O)}if(K){s.removeClass(N)}else{s.addClass(N)}if(!I.jSCell.edited){I.jSCell.edited=true;u=P.add(I.jSCell)}}while(M--);return true}return false},cellTypeToggle:function(K,u){u=u||y.highlighted(true);if(u.length<1){return}var I=u.length-1,s=u[I].cellType==K;if(I>=0){do{if(s){u[I].cellType=null}else{u[I].cellType=K}u[I].calcLast=0;y.updateCellValue.call(u[I])}while(I--)}},fontReSize:function(N,L){L=L||y.highlighted();if(L.length<1){return false}var I=0;switch(N){case"up":I=1;break;case"down":I=-1;break}var K,s,M=L.length-1,P,O=y.obj.cellsEdited(),u=y.controls.cellsEdited[y.i];if(M>=0){do{K=L[M];s=h(K);P=(s.css("font-size")+"").replace("px","")*1;s.css("font-size",((P||10)+I)+"px");if(!K.jSCell.edited){K.jSCell.edited=true;u=O.add(K.jSCell)}}while(M--);return true}return false},callStack:0,updateCellValue:function(O,K,M){var I,P,N,L;if(!this.type||!this.type=="cell"){if(!(I=y.spreadsheets[O])){return J.error({error:y.msg.notFoundSheet})}if(!(P=I[K])){return J.error({error:y.msg.notFoundRow})}if(!(N=P[M])){return J.error({error:y.msg.notFoundColumn})}}else{N=this}N.oldValue=N.value;if(N.result){delete N.result}switch(N.state[N.state.length-1]){case"updating":return J.error({error:y.msg.loopDetected});case"updatingDependencies":return(N.valueOverride!=G?N.valueOverride:N.value)}if(N.defer){return y.updateCellValue.call(N.defer)}N.state.push("updating");N.fnCount=0;N.result=null;if(N.calcLast!=y.calcLast||N.calcDependenciesLast!=y.calcDependenciesLast){N.valueOverride=null;N.calcLast=y.calcLast;N.calcDependenciesLast=y.calcDependenciesLast;N.needsUpdated=true;N.calcCount++;if(N.formula){try{if(N.formula.charAt(0)=="="){N.formula=N.formula.substring(1)}var s;if(y.callStack){if(!N.formulaParser){N.formulaParser=j.Formula(y.cellHandler)}s=N.formulaParser}else{s=y.formulaParser}y.callStack++;s.setObj(N);N.result=s.parse(N.formula)}catch(u){N.result=u.toString()}y.callStack--;if(N.cellType&&J.cellTypeHandlers[N.cellType]){N.result=J.cellTypeHandlers[N.cellType].call(N,N.result)}y.filterValue.call(N)}else{if(N.cellType&&J.cellTypeHandlers[N.cellType]){N.result=J.cellTypeHandlers[N.cellType].call(N,N.value);y.filterValue.call(N)}else{if(N.value!=G&&N.value.charAt){L=y.s.cellStartingHandlers[N.value.charAt(0)];if(L){N.valueOverride=L.call(N,N.value)}else{L=y.s.cellEndHandlers[N.value.charAt(N.value.length-1)];if(L){N.valueOverride=L.call(N,N.value)}}}y.filterValue.call(N)}}}N.needsUpdated=false;N.state.pop();return(N.valueOverride!=G?N.valueOverride:N.value)},updateCellDependencies:function(){if((this.state||(this.state=[])).length){return}this.state.push("updatingDependencies");var K=this.dependencies||[];this.dependencies=[];var u=K.length-1;if(u>-1){do{var s=K[u],I=y.getTdLocation(s.td);s.calcDependenciesLast=0;y.updateCellValue.call(s);if(I.row>0&&I.col>0){y.updateCellDependencies.call(s)}}while(u--)}this.state.pop()},filterValue:function(){var s,u;if(this.result!=G){this.value=this.result.valueOf();u=this.result.html}else{if(typeof this.value=="string"&&this.value.length>0){s=J.encode(this.value)}}this.td.html(u||s||this.value)},cellHandler:{variable:function(){if(arguments.length){var K=arguments[0],u=arguments[1],L=y.s.formulaVariables,I,s;switch(K.toLowerCase()){case"true":s=new g(true);s.html="TRUE";return s;case"false":s=new g(false);s.html="FALSE";return s}if(I=L[K]&&!u){return I}else{if(I&&u){return I[u]}else{return""}}}},time:function(u,s){return a.fromString(u,s)},number:function(s){switch(typeof s){case"number":return s;case"string":if(!v(s)){return s*1}case"object":if(s.getMonth){return b.toCentury(s)}}return s},numberInverted:function(I){var u=y.cellHandler.number(I),s=new k(u.valueOf()*-1);if(u.html){s.html=u.html}return s},performMath:function(N,M,L){var K,I,O=true,s=true,Q=[],P,u=function(R){return R};switch(K=(typeof M.valueOf())){case"number":break;case"string":if(!v(M)){M*=1}else{O=false}break;case"object":if(M.getMonth){M=b.toCentury(M);u=b.get}else{O=false}break;default:O=false}switch(I=(typeof L.valueOf())){case"number":break;case"string":if(!v(L)){L*=1}else{s=false}break;case"object":if(L.getMonth){L=b.toCentury(L)}else{s=false}break;default:s=false}if(!O){Q.push("not a number: "+M);M=0}if(!s){Q.push("not a number: "+L);L=0}if(Q.length){}switch(N){case"+":P=M+L;break;case"-":P=M-L;break;case"/":P=M/L;if(P==Infinity||P==F){P=0}break;case"*":P=M*L;break;case"^":P=C.pow(M,L);break}return u(P)},cellValue:function(I){var u=d.parseLocation(I),s;s=y.cellHandler.createDependency.call(this,this.sheet,u);y.updateCellValue.call(s);return(s.valueOverride!=G?s.valueOverride:s.value)},createDependency:function(u,L){var I,K,s;if(!(I=y.spreadsheets[u])){return null}if(!(K=I[L.row])){return null}if(!(s=K[L.col])){return null}if(!s.dependencies){s.dependencies=[]}if(h.inArray(this,s.dependencies)<0){s.dependencies.push(this)}return s},cellRangeValue:function(s,u){s=d.parseLocation(s);u=d.parseLocation(u);var P=[],K=C.max(s.row,u.row),O=C.min(s.row,u.row),I=C.max(s.col,u.col),L=I,M=C.min(s.col,u.col),N;if(K>=O||I>=M){do{I=L;do{N=y.spreadsheets[this.sheet][K][I];y.cellHandler.createDependency.call(this,this.sheet,{row:K,col:I});P.unshift(y.updateCellValue.call(N))}while(I-->M)}while(K-->O);return P}return P},fixedCellValue:function(s){s=s.replace(/\$/g,"");return y.cellHandler.cellValue.call(this,s)},fixedCellRangeValue:function(u,s){u=u.replace(/\$/g,"");s=s.replace(/\$/g,"");return y.cellHandler.cellRangeValue.call(this,u,s)},remoteCellValue:function(u,K){var I=d.parseLocation(K),s=d.parseSheetLocation(u);y.cellHandler.createDependency.call(this,s,I);return y.updateCellValue(s,I.row,I.col)},remoteCellRangeValue:function(L,M,u){L=d.parseSheetLocation(L);M=d.parseLocation(M);u=d.parseLocation(u);var s=[];for(var K=M.row;K<=u.row;K++){for(var I=M.col;I<=u.col;I++){s.push(y.updateCellValue(L,K,I))}}return[s]},callFunction:function(I,u){I=I.toUpperCase();u=u||[];if(h.sheet.fn[I]){this.fnCount++;var s=h.sheet.fn[I].apply(this,u);return s}else{return J.error({error:"Function "+I+" Not Found"})}}},cellLookupHandlers:{fixedCellValue:function(s){return[y.sheet,d.parseLocation(s),d.parseLocation(s)]},fixedCellRangeValue:function(u,I,s){return[d.parseSheetLocation(u),d.parseLocation(I),d.parseLocation(s)]},cellValue:function(s){},cellRangeValue:function(u,I,s){return[y.sheet,d.parseLocation(I),d.parseLocation(s)]},remoteCellValue:function(s,u){return[y.sheet,d.parseLocation(u),d.parseLocation(u)]},remoteCellRangeValue:function(u,I,s){return[d.parseSheetLocation(u),d.parseLocation(I),d.parseLocation(s)]},callFunction:function(){if(arguments[0]=="VLOOKUP"||arguments[0]=="HLOOKUP"&&arguments[1]){if(arguments[1]&&arguments[1][1]){return arguments[1][1]}return[]}}},cellLookup:function(){var s=Formula(h.extend({},y.cellHandler,y.cellLookupHandlers));s.setObj(this);var I=s.parse(this.formula),K=[];for(var L=I[1].row;L<=I[2].row;L++){for(var u=I[1].col;u<=I[2].col;u++){K.push(y.getCell(L,u,I[0]))}}return K},calcLast:0,calcDependenciesLast:0,calc:function(s,I){s=s||y.i;if(y.readOnly[s]||y.isChanged(s)===false&&!I||!y.formulaParser){return false}y.calcLast=new l();var u=y.spreadsheetToArray(null,s);d.calc(s,u,y.updateCellValue);y.trigger("sheetCalculation",[{which:"speadsheet",sheet:u,index:s}]);y.setChanged(false);return true},calcDependencies:function(I,u){I=I||new l();y.calcDependenciesLast=I;if(!u){var s=this;y.undo.createCells([this],function(K){y.trigger("sheetPreCalculation",[{which:"cell",cell:s}]);y.setDirty(true);y.setChanged(true);y.updateCellValue.call(s);y.updateCellDependencies.call(s);y.trigger("sheetCalculation",[{which:"cell",cell:s}]);return K})}else{y.trigger("sheetPreCalculation",[{which:"cell",cell:this}]);y.setDirty(true);y.setChanged(true);y.updateCellValue.call(this);y.updateCellDependencies.call(this);y.trigger("sheetCalculation",[{which:"cell",cell:this}])}},addSheet:function(s){s=s||{rows:25,cols:10};if(s){y.evt.cellEditAbandon();y.setDirty(true);y.controlFactory.sheetUI(y.obj.ui()[0],h.sheet.makeTable(s),y.sheetCount);y.setActiveSheet(y.sheetCount);y.sheetCount++;y.sheetSyncSize();y.obj.pane().resizeScroll();y.trigger("sheetAdd",[y.i])}},deleteSheet:function(s){var u=s||y.i;y.obj.barHelper().remove();y.obj.enclosure().remove();y.obj.menus().remove();y.obj.tabContainer().children().eq(y.i).remove();y.spreadsheets.splice(u,1);y.controls.autoFiller.splice(u,1);y.controls.bar.helper.splice(u,1);y.controls.bar.corner.splice(u,1);y.controls.bar.x.controls.splice(u,1);y.controls.bar.x.handleFreeze.splice(u,1);y.controls.bar.x.controls.splice(u,1);y.controls.bar.x.menu.splice(u,1);if(y.controls.bar.x.menuParent&&y.controls.bar.x.menuParent[u]){y.controls.bar.x.menuParent.splice(u,1)}y.controls.bar.x.parent.splice(u,1);y.controls.bar.x.scroll.splice(u,1);y.controls.bar.x.td.splice(u,1);y.controls.bar.y.controls.splice(u,1);y.controls.bar.y.handleFreeze.splice(u,1);y.controls.bar.y.controls.splice(u,1);y.controls.bar.y.menu.splice(u,1);if(y.controls.bar.y.menuParent&&y.controls.bar.y.menuParent[u]){y.controls.bar.y.menuParent.splice(u,1)}y.controls.bar.y.parent.splice(u,1);y.controls.bar.y.scroll.splice(u,1);y.controls.bar.y.td.splice(u,1);y.controls.barMenuLeft.splice(u,1);y.controls.barMenuTop.splice(u,1);y.controls.barLeft.splice(u,1);y.controls.barTop.splice(u,1);y.controls.barTopParent.splice(u,1);y.controls.chart.splice(u,1);y.controls.tdMenu.splice(u,1);y.controls.enclosure.splice(u,1);y.controls.fullScreen=null;y.controls.inPlaceEdit.splice(u,1);y.controls.menus.splice(u,1);y.controls.menuLeft.splice(u,1);y.controls.menuRight.splice(u,1);y.controls.pane.splice(u,1);y.controls.scroll.splice(u,1);y.controls.tables.splice(u,1);y.controls.table.splice(u,1);y.controls.tab.splice(u,1);y.controls.toggleHide.x.splice(u,1);y.controls.toggleHide.y.splice(u,1);y.readOnly.splice(u,1);y.i=0;y.sheetCount--;y.sheetCount=C.max(y.sheetCount,0);if(y.sheetCount==0){y.addSheet()}y.setActiveSheet(y.i);y.setDirty(true);y.setChanged(true);y.trigger("sheetDelete",[u])},deleteRow:function(L,u){var K,N,s,M,I=y.sheetSize();if(L){N=s=L}else{N=C.min(y.highlightedLast.start.row,y.highlightedLast.end.row);s=C.max(y.highlightedLast.start.row,y.highlightedLast.end.row)}M=(s-N)+1;if(N<1||I.cols<2||M>=I.rows){return}K=s;do{y.getTd(y.i,K,1).parent().remove()}while(N<K--);y.controls.bar.y.td[y.i].splice(N,M);y.spreadsheets[y.i].splice(N,M);y.refreshRowLabels(N);y.setChanged(true);y.offsetFormulas({row:N,col:0},{row:-M,col:0},false,true);y.setDirty(true);y.evt.cellEditAbandon();y.obj.pane().resizeScroll();y.trigger("sheetDeleteRow",K)},deleteColumn:function(N){var L,s,K,P,R=y.sheetSize();if(N){s=K=N}else{s=C.min(y.highlightedLast.start.col,y.highlightedLast.end.col);K=C.max(y.highlightedLast.start.col,y.highlightedLast.end.col)}P=(K-s)+1;if(s<1||R.cols<2||P>=R.cols){return}L=K;y.obj.barHelper().remove();do{var Q=y.obj.table(),u=y.col(Q[0],L),O=y.obj.barTop(L).remove(),M=u.tds,I=M.length-1;do{h(M[I]).remove()}while(I--);y.obj.barTop(L).remove();h(u).remove()}while(s<L--);y.controls.bar.x.td[y.i].splice(s,P);I=y.spreadsheets[y.i].length-P;do{y.spreadsheets[y.i][I].splice(s,P)}while(I-->1);y.refreshColumnLabels(s);y.setChanged(true);y.offsetFormulas({row:0,col:s},{row:0,col:-P},false,true);y.setDirty(true);y.evt.cellEditAbandon();y.obj.pane().resizeScroll();y.trigger("sheetDeleteColumn",L)},sheetTab:function(u){var s="";if(u){s=y.obj.table().attr("title");s=(s?s:y.msg.sheetTitleDefault.replace(/[{]index[}]/gi,y.i+1))}else{if(y.isSheetEditable()&&J.editableNames){var I=y.trigger("prompt",[y.msg.newSheetTitle,y.sheetTab(true)]);if(!I){s=y.obj.table().attr("title");I=(s?s:y.msg.sheetTitleDefault.replace(/[{]index[}]/gi,y.i+1))}else{y.setDirty(true);y.obj.table().attr("title",I);y.obj.tab().html(I);s=I}}}return h(o.createElement("div")).text(s).html()},tdNotVisible:function(u){var I=y.obj.pane(),K=u[0],R={top:0,bottom:I.clientHeight,left:0,right:I.clientWidth},O=u.width(),M=u.height(),P={top:K.offsetTop,bottom:K.offsetTop+M,left:K.offsetLeft,right:K.offsetLeft+O},s=u.parent();if(!K.col){return false}var Q=h(K.barTop).is(":hidden"),L=s.is(":hidden"),N={up:L,down:P.bottom>R.bottom&&M<=I.clientHeight,left:Q,right:P.right>R.right&&O<=I.clientWidth};if(N.up||N.down||N.left||N.right){return N}return false},followMe:function(L){L=L||y.obj.tdActive();if(!L.length){return}var I=0,s=0,N=0,K,M=y.obj.pane();M.scrollStyleX.i=0;M.scrollStyleY.i=0;y.setBusy(true);while((K=this.tdNotVisible(L))&&I<25){var u=y.scrolledTo();if(K.left){s--;y.evt.scroll.scrollTo({axis:"x",value:u.end.col-1})}else{if(K.right){s++;y.evt.scroll.scrollTo({axis:"x",value:u.end.col+1})}}if(K.up){N--;y.evt.scroll.scrollTo({axis:"y",value:u.end.row-1})}else{if(K.down){N++;y.evt.scroll.scrollTo({axis:"y",value:u.end.row+1})}}I++}setTimeout(function(){y.setBusy(false)},100);y.evt.scroll.stop();y.autoFillerGoToTd(L)},autoFillerGoToTd:function(K,u,s){if(!J.autoFiller){return}K=K||y.obj.tdActive();var L=K[0];if(L&&L.type=="cell"){u=u||L.clientHeight;s=s||L.clientWidth;if(!L.offsetHeight||!L.offsetWidth||!L.clientHeight||!L.clientWidth){y.autoFillerHide();return}var I=K.position();y.obj.autoFiller().show().css("top",((I.top+(u||K.height())-3)+"px")).css("left",((I.left+(s||K.width())-3)+"px"))}},autoFillerHide:function(){if(!J.autoFiller){return}y.obj.autoFiller().hide()},setActiveSheet:function(I){I=I||0;if(y.cellLast.row>0||y.cellLast.col>0){y.evt.cellEditDone();y.obj.formula().val("")}var u=y.obj.enclosures(),s=u.length-1,K;y.autoFillerHide();if(s>0){do{if(I!=s){K=u[s];K._scrollLeft=K._scrollLeft||K.scrollUI.scrollLeft;K._scrollTop=K._scrollTop||K.scrollUI.scrollTop;K.style.display="none"}}while(s-->0)}y.i=I;K=u[I];K.style.display="";y.themeRoller.tab.setActive();y.readOnly[I]=(K.table.className||"").match(/\breadonly\b/i)!=null;K.pane.resizeScroll(true);K.scrollUI.scrollLeft=K._scrollLeft||K.scrollUI.scrollLeft;K.scrollUI.scrollTop=K._scrollTop||K.scrollUI.scrollTop;K._scrollLeft=K._scrollTop=null;K.scrollUI.onscroll()},openSheet:function(L){if(y.isDirty?y.trigger("confirm",[y.msg.openSheet]):true){y.setBusy(true);var N=y.controlFactory.header(),M=y.controlFactory.ui(),u=y.controlFactory.tabContainer(),K,I,s=[];y.sheetCount=L.length-1;N.ui=M;N.tabContainer=u;M.header=N;M.tabContainer=u;u.header=N;u.ui=M;J.parent.append(N).append(M).append(u);for(K=0;K<L.length;K++){if(h.sheet.max){I=y.tableSize(L[K]);if(I.rows>h.sheet.max||I.cols>h.sheet.max){y.trigger("sheetMaxSize",[L[K],K]);if(!y.trigger("confirm",y.msg.maxSizeBrowserLimitationOnOpen)){continue}}}y.controlFactory.sheetUI(M,L[K],K);y.sheetCount++;s.push(y.calc);y.trigger("sheetOpened",[K])}y.resizableSheet(J.parent,{minWidth:J.parent.width()*0.1,minHeight:J.parent.height()*0.1,start:function(){y.setBusy(true);y.obj.enclosure().hide();M.tabContainer.hide()},stop:function(){y.obj.enclosure().show();M.tabContainer.show();y.setBusy(false);y.sheetSyncSize();y.obj.pane().resizeScroll()}});y.sheetSyncSize();y.setActiveSheet(0);y.setDirty(false);y.setBusy(false);while(s.length){s.pop()(y.i=s.length)}y.trigger("sheetAllOpened");return true}else{return false}},newSheet:function(){J.parent.html(h.sheet.makeTable()).sheet(J)},sheetSyncSize:function(){var u=J.parent[0].clientHeight;if(!u){u=400;J.parent.height(u)}else{if(u<200){u=200;J.parent.height(u)}}var s=J.parent[0].clientWidth;u-=y.obj.header().outerHeight();u-=y.obj.tabContainer().outerHeight()+y.s.boxModelCorrection;y.obj.panes().height(u-j.scrollBarSize.height-J.boxModelCorrection).width(s-j.scrollBarSize.width);y.obj.enclosures().height(u).width(s);y.obj.scrolls().height(u).width(s);y.obj.ui().height(u).width(s)},cellChangeStyle:function(I,K,s){s=s||y.highlighted(true);if(s.length<1){return false}y.setDirty(this);var u=s.length-1;if(u>=0){y.undo.createCells(s,function(L){do{L[u].td.css(I,K)}while(u--);return L});return true}return false},cellFind:function(u){if(!u){u=y.trigger("prompt",[y.msg.cellFind])}var s=y.obj.table().children("tbody").children("tr");if(u){var I=s.children('td:contains("'+u+'")');if(I.length<1){I=s.children('td:contains("'+u.toLowerCase()+'")')}if(I.length<1){I=s.children('td:contains("'+u.toUpperCase()+'")')}I=I.eq(0);if(I.length>0){y.cellEdit(I)}else{y.trigger("alert",[y.msg.cellNoFind])}}},cellSetActiveBar:function(Q,K,L){var U=y.sheetSize(),N=C.min(K,L),S=C.max(K,L),u={},R={},s=function(V){switch(J.cellSelectModel){case"oo":this.row=(V?u.row:R.row);this.col=(V?u.col:R.col);this.td=y.getTd(y.i,this.row,this.col);if(!this.td.is(y.cellLast.td)){y.cellEdit(this.td,false,true)}break;default:this.row=(V?R.row:u.row);this.col=(V?R.col:u.col);this.td=y.getTd(y.i,this.row,this.col);if(!this.td.is(y.cellLast.td[0])){y.cellEdit(this.td,false,true)}break}},M=[],O=y.scrolledTo(),P=y.obj.table(),I,T;switch(Q){case"top":u.row=O.end.row;u.col=N;R.row=O.end.row;R.col=S;y.highlightedLast.start.row=1;y.highlightedLast.start.col=N;y.highlightedLast.end.row=U.rows;y.highlightedLast.end.col=S;I=S;do{M.push(y.col(P[0],I))}while(I-->N);break;case"left":u.row=N;u.col=O.end.col;R.row=S;R.col=O.end.col;y.highlightedLast.start.row=N;y.highlightedLast.start.col=1;y.highlightedLast.end.row=S;y.highlightedLast.end.col=U.cols;T=S;do{M.push(y.getTd(y.i,T,1)[0].parentNode)}while(T-->N);break;case"corner":u.row=1;u.col=1;R.col=U.cols;R.row=U.rows;M.push(P[0]);break}s(K>L);y.themeRoller.cell.setHighlighted(h(M))},getTdRange:function(K,P,N,O){y.cellLast.isEdit=true;var u=function(R){if(R.first.col>R.last.col||R.first.row>R.last.row){return{first:d.parseCellName(R.last.col,R.last.row),last:d.parseCellName(R.first.col,R.first.row)}}else{return{first:d.parseCellName(R.first.col,R.first.row),last:d.parseCellName(R.last.col,R.last.row)}}},M=function(U){var R=u(U),T=P+"";T=(T.match(/=/)?T:"="+T);if(N||T.charAt(T.length-1)!="("){T=T+(N?N:"")+"("}var V,S="";if(R.first!=R.last){V=R.first+":"+R.last}else{V=R.first}if(T.charAt(T.length-1)=="("){S=")"}return T+V+S},s="",I,L,Q;if(K){I={first:y.getTdLocation([K.target])};L=y.obj.table().mousemove(function(R){I.last=y.getTdLocation([R.target]);s=M(I);if(!O){y.obj.formula().val(s);y.obj.inPlaceEdit().val(s)}});x.one("mouseup",function(){L.unbind("mousemove");return s})}else{Q=y.highlighted().not(y.obj.tdActive());if(Q.length){I={first:y.getTdLocation(Q.first()),last:y.getTdLocation(Q.last())};s=M(I);if(!O){y.obj.formula().val(s);y.obj.inPlaceEdit().val(s)}return s}else{return""}}return""},getTd:function(L,N,u){var I=y.obj.tables()[L],s,K,M;if(!I||!(s=I.tBody)||!(K=s.children[N])||!(M=K.children[u])){M=o.createElement("td")}return h(M)},getTdLocation:function(u){var s={col:0,row:0};u=u||"";if(!u&&!u[0]){return s}u=u[0]||u;if(u.parentNode==G||u.parentNode.rowIndex<0){return s}return{col:parseInt(u.cellIndex),row:parseInt(u.parentNode.rowIndex)}},getBarIndex:{left:function(s){s=s||{};if(!s.parentNode||v(s.parentNode.rowIndex)){return -1}else{return s.parentNode.rowIndex}},top:function(s){s=s||{};if(v(s.cellIndex)){return -1}else{return s.cellIndex}},corner:function(){return 0}},time:{now:new l(),last:new l(),diff:function(){return C.abs(C.ceil(this.last.getTime()-this.now.getTime())/1000).toFixed(5)},set:function(){this.last=this.now;this.now=new l()},get:function(){return this.now.getHours()+":"+this.now.getMinutes()+":"+this.now.getSeconds()}},changed:[],isChanged:function(s){return y.changed[s||y.i]},setChanged:function(s){y.changed[y.i]=s},isDirty:false,setDirty:function(s){y.dirty=s},appendToFormula:function(s){var I=y.obj.formula(),u=I.val();if(u.charAt(0)!="="){u="="+u}I.val(u+s)},undo:{manager:(j.UndoManager?new UndoManager():{undo:E,redo:E,register:E,notLoaded:true}),cells:[],id:0,createCells:function(s,u,L){if(this.manager.notLoaded){this.createCells=function(M,N,O){return N(M)};return this.createCells(s,u,L)}if(L==G){y.undo.id++;L=y.undo.id}var I=new t(s).clone().cells,K=(u?new t(u(s)).clone().cells:I);I.id=L;K.id=L;y.undo.manager.register(G,y.undo.removeCells,[I,L],"Remove Cells",G,y.undo.createCells,[K,null,L],"Create Cells");if(L!=y.undo.id||!u){y.undo.draw(K)}return true},removeCells:function(u,K){var I=0,s=-1;if(u.id===K){s=I}if(s!==-1){}y.undo.draw(u)},draw:function(I){var u;for(u=0;u<I.length;u++){var L=I[u],K=y.getTdLocation(L.td),s=y.spreadsheets[L.sheet][K.row][K.col];s.value=L.value;s.formula=L.formula;s.td=L.td;s.dependencies=L.dependencies;s.needsUpdated=L.needsUpdated;s.calcCount=L.calcCount;s.sheet=L.sheet;s.calcLast=L.calcLast;s.html=L.html;s.state=L.state;s.jS=L.jS;s.calcDependenciesLast=L.calcDependenciesLast;s.td.attr("style",L.style);s.td.attr("class",L.cl);y.updateCellValue.call(s)}}},cols:function(s){s=s||y.obj.table()[0];if(!s){return[]}if(!s.colGroup){return[]}if(!s.colGroup.children){return[]}return s.colGroup.children},tables:function(Q,L){Q=Q||y.obj.tables();var P=[],I=Q.length-1,u,S,O,s,T,K,R,M,N;do{S=(L?o.body.removeChild(Q[I]):Q[I].cloneNode(true));if((s=S.children[0])&&(T=s.children[0])){s.removeChild(T)}if(O=S.children[1]){M=O.children;R=M[0];O.removeChild(R);u=M.length-1;do{N=M[u];K=N.children[0];N.removeChild(K)}while(u-->0)}P[I]=S}while(I-->0);return y.sheetDecorateRemove(false,h(P))},col:function(u,s){u=u||y.obj.table()[0];var I=y.cols(u);if(s===G){s=I.length-1}return I[s]},rowTds:function(u,s){u=u||y.obj.table();var I=y.rows(u);if(!I.length){return[]}if(s==G){s=I.length-1}if(!I[s]){return[]}if(!I[s].children){return[]}return I[s].children},rows:function(s){s=s||y.obj.table()[0];if(!s){return[]}if(!s.tBody){return[]}if(!s.tBody.children){return[]}return s.tBody.children},highlighted:function(u){var K=y.highlightedLast.obj||h([]),L=[],s,I;if(!(s=K)||!K.length||!(s=s[0])||!s.tagName){return u?L:h(L)}switch(s.tagName){case"TD":I=K.length-1;do{L.unshift(u?K[I].jSCell:K[I])}while(I-->0);break;case"TR":I=K.length-1;do{if(K[I].tds){L=L.concat(u?K[I].jSCells:K[I].tds)}}while(I-->0);break;case"COL":K=K.filter("col");I=K.length-1;do{if(K[I].tds){L=L.concat(u?K[I].jSCells:K[I].tds)}}while(I-->0);break;case"TABLE":L=(u?s.jSCells:s.tds);break}return u?L:h(L)},sheetSize:function(u){u=u||y.obj.table()[0];var s=y.rowTds(u),I=y.getTdLocation(s[s.length-1]);return{cols:I.col,rows:I.row}},sort:function(M){var K=y.highlighted(true),L=K.length,I=0,u=[],s;while(I<L){u.push(K[I].value);I++}if(M){u.sort(function(O,N){return O-N})}else{u.sort(function(O,N){return N-O})}while(K.length){s=K.pop();s.value=u[K.length];s.calcLast=0;y.updateCellValue.call(s);y.updateCellDependencies.call(s)}},tableSize:function(I){I=I||y.obj.table()[0];var s=(I.children[0].nodeName!="TBODY"?I.children[1]:I.children[0]).children,u=s[s.length-1].children,L=u[u.length-1],K=y.getTdLocation(L);return{cols:K.col,rows:K.row}},toggleState:function(s){if(J.allowToggleState){var u=s||y.tables();if(J.editable){y.evt.cellEditAbandon();y.trigger("sheetSave",[u])}y.setDirty(false);y.setChanged(true);J.editable=!J.editable;y.kill();J.parent.html(u).sheet(J);J=null}},setCellRef:function(u){var K=y.obj.tdActive(),I=y.getTdLocation(K),s=(u?u:y.trigger("prompt",[y.msg.setCellRef]));if(s){y.s.formulaVariables[s]=y.updateCellValue(y.i,I.row,I.col)}},formulaParser:null};y.setBusy(true);J.parent[0].jS=y;if(!j.console){j.console={log:function(){}}}if(!j.scrollBarSize){j.scrollBarSize=h.sheet.getScrollBarSize()}if(j.Formula){y.formulaParser=j.Formula(y.cellHandler)}J.origHtml=J.parent.children().detach();J.parent.addClass(y.cl.parent);J.parent.bind("sheetSwitch",function(I,u,s){y.switchSheet(s)}).bind("sheetRename",function(I,u,s){y.renameSheet(s)});J.width=(J.width?J.width:J.parent.width());J.height=(J.height?J.height:J.parent.height());if(!h.nearest){y.nearest=E}y.resizableCells=y.resizableSheet=y.resizable;if(!h.ui){y.resizable=y.resizableCells=y.resizableSheet=y.draggable=E}else{if(!J.resizableCells){y.resizableCells=E}if(!J.resizableSheet){y.resizableSheet=E}}if(!h.support.boxModel){J.boxModelCorrection=0}if(!J.barMenus){y.controlFactory.barMenuTop=y.controlFactory.barMenuLeft=E}if(!J.freezableCells){y.controlFactory.barHandleFreeze.top=y.controlFactory.barHandleFreeze.left=E}if(J.calcOff){y.calc=E}if(!j.Raphael){d.chart=E}r.resize(function(){if(y&&!y.isBusy()){J.width=J.parent.width();J.height=J.parent.height();y.sheetSyncSize()}});if(h.sheet.fn){h.sheet.fn=h.extend(h.sheet.fn,J.formulaFunctions);if(h.sheet.advancedfn){h.sheet.fn=h.extend(h.sheet.fn,h.sheet.advancedfn)}if(h.sheet.financefn){h.sheet.fn=h.extend(h.sheet.fn,h.sheet.financefn)}}J.title=J.title||J.parent.attr("title")||"";y.s=J;J.parent.addClass(y.cl.uiParent);if(J.origHtml.length){y.openSheet(J.origHtml)}y.setBusy(false);J.parent.bind("alert",function(u,s,I){alert(I)}).bind("prompt",function(I,u,K,s){return prompt(K,s)}).bind("confirm",function(u,s,I){return confirm(I)});return y},makeTable:function(D,t,r){var B=document;D=D||{rows:25,cols:10};t=t||120;r=r||15;var C=B.createElement("table"),s=B.createElement("colgroup"),A=B.createElement("tbody"),x="width:"+t+"px;",v="height:"+r+"px;",z,u,y,w;y=D.cols;do{u=B.createElement("col");u.setAttribute("style",x);s.appendChild(u)}while(y--);y=D.rows;do{z=B.createElement("tr");z.setAttribute("style",v);w=D.cols;do{z.appendChild(B.createElement("td"))}while(w-->1);A.appendChild(z)}while(y-->1);C.appendChild(s);C.appendChild(A);return C},killAll:function(){if(h.sheet){var r=h.sheet.instance;if(r){for(var s=0;s<r.length;s++){if(r[s]&&r[s].kill){r[s].kill()}}h.sheet.instance=[]}}},scrollLocker:function(s){var r=h.sheet.instance;r[s].obj.scrolls().each(function(t){var u=this;h(this).scroll(function(w){var v=r.length-1,x;if(v>-1){do{x=r[v].controls.scroll[t][0];x.scrollLeft=u.scrollLeft;x.scrollTop=u.scrollTop}while(v--)}})})},switchSheetLocker:function(r){h.each(h.sheet.instance,function(){this.s.parent.bind("sheetSwitch",function(u,t,s){h.each(h.sheet.instance,function(){this.setActiveSheet(s)})})})},I:function(){var r=0;if(this.instance){r=(this.instance.length===0?0:this.instance.length-1)}else{this.instance=[]}return r},getScrollBarSize:function(){var x=document,A=h(x.createElement("p")).css({width:"100%",height:"100%"}),z=h(x.createElement("div")).css({position:"absolute",width:"100px",height:"100px",top:"0",left:"0",visibility:"hidden",overflow:"hidden"}).append(A);h(x.body).append(z);var t=A.width(),v=A.height();z.css("overflow","scroll");var r=A.width(),u=A.height();if(t==r&&z[0].clientWidth){r=z[0].clientWidth}if(v==u&&z[0].clientHeight){u=z[0].clientHeight}z.detach();var y=t-r,s=v-u;return{width:y||15,height:s||15}},debugPositionBox:function(r,w,t,s,v){s=s||"#"+c.floor(c.random()*16777215).toString(16);if(t){var u=h([]);u=u.add(this.debugPositionBox(t.left,t.top,null,s,"top-left"));u=u.add(this.debugPositionBox(t.right,t.top,null,s,"top-right"));u=u.add(this.debugPositionBox(t.left,t.bottom,null,s,"bottom-left"));u=u.add(this.debugPositionBox(t.right,t.bottom,null,s,"bottom-right"));return u}return h('<div style="width: 10px; height: 10px; position: absolute;"></div>').css("top",(w-5)+"px").css("left",(r+5)+"px").css("background-color",s).click(function(){console.log(v||"none")}).appendTo("body")}};var d=h.sheet.engine={calc:function(t,r,u){r=r||[];var v=r.length-1,s;if(v>0){do{if(v>0&&r[v]){s=r[v].length-1;if(s>0){do{u(t,v,s)}while(s--)}}}while(v--)}},parseLocation:function(s){for(var r=0;r<s.length;r++){if(s.charCodeAt(r)<=57){break}}return{row:parseInt(s.substring(r)),col:d.columnLabelIndex(s.substring(0,r))}},parseSheetLocation:function(r){return((r+"").replace("SHEET","")*1)-1},parseCellName:function(r,s){return d.columnLabelString(r)+(s||"")},alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),columnLabels:{},columnLabelIndex:function(r){return this.columnLabels[r.toUpperCase()]},columnIndexes:[],columnLabelString:function(v){if(!this.columnIndexes.length){var x="",w,u,t,r;w=u=t=-1;for(r=1;r<16385;++r){x="";++t;if(t==26){t=0;++u;if(u==26){u=0;++w}}if(w>=0){x+=this.alphabet[w]}if(u>=0){x+=this.alphabet[u]}if(t>=0){x+=this.alphabet[t]}this.columnIndexes[r]=x;this.columnLabels[x]=r}}return this.columnIndexes[v]||""},regEx:{n:/[\$,\s]/g,cell:/\$?([a-zA-Z]+|[#]REF[!])\$?([0-9]+|[#]REF[!])/gi,range:/\$?([a-zA-Z]+)\$?([0-9]+):\$?([a-zA-Z]+)\$?([0-9]+)/gi,remoteCell:/\$?(SHEET+)\$?([0-9]+)[:!]\$?([a-zA-Z]+)\$?([0-9]+)/gi,remoteCellRange:/\$?(SHEET+)\$?([0-9]+)[:!]\$?([a-zA-Z]+)\$?([0-9]+):\$?([a-zA-Z]+)\$?([0-9]+)/gi,sheet:/SHEET/i,amp:/&/g,gt:/</g,lt:/>/g,nbsp:/&nbsp;/g},chart:function(u){var t=this.jS,r=this;function s(w,x){if(!w){if(x){w=0}else{w=""}}else{if(x){w=f.toNumbers(w)}else{w=f.flatten(w)}}return w}u=h.extend({x:{legend:"",data:[0]},y:{legend:"",data:[0]},title:"",data:[0],legend:"",td:this.td,chart:h(o.createElement("div")).addClass(t.cl.chart).mousedown(function(){u.td.mousedown()}),gR:{}},u);t.controls.chart[t.i]=t.obj.chart().add(u.chart);u.data=s(u.data,true);u.x.data=s(u.x.data,true);u.y.data=s(u.y.data,true);u.legend=s(u.legend);u.x.legend=s(u.x.legend);u.y.legend=s(u.y.legend);u.legend=(u.legend?u.legend:u.data);t.s.parent.one("sheetCalculation",function(){var w=u.chart.width(),v=u.chart.height(),x=Raphael(u.chart[0]);if(u.title){x.text(w/2,10,u.title).attr({"font-size":20})}switch(u.type){case"bar":u.gR=x.barchart(w/8,v/8,w*0.8,v*0.8,u.data,u.legend).hover(function(){this.flag=x.popup(this.bar.x,this.bar.y,this.bar.value||"0").insertBefore(this)},function(){this.flag.animate({opacity:0},300,function(){this.remove()})});break;case"hbar":u.gR=x.hbarchart(w/8,v/8,w*0.8,v*0.8,u.data,u.legend).hover(function(){this.flag=x.popup(this.bar.x,this.bar.y,this.bar.value||"0").insertBefore(this)},function(){this.flag.animate({opacity:0},300,function(){this.remove()})});break;case"line":u.gR=x.linechart(w/8,v/8,w*0.8,v*0.8,u.x.data,u.y.data,{nostroke:false,axis:"0 0 1 1",symbol:"circle",smooth:true}).hoverColumn(function(){this.tags=x.set();if(this.symbols.length){for(var y=0,z=this.y.length;y<z;y++){this.tags.push(x.tag(this.x,this.y[y],this.values[y],160,10).insertBefore(this).attr([{fill:"#fff"},{fill:this.symbols[y].attr("fill")}]))}}},function(){this.tags&&this.tags.remove()});break;case"pie":u.gR=x.piechart(w/2,v/2,(w<v?w:v)/2,u.data,{legend:u.legend}).hover(function(){this.sector.stop();this.sector.scale(1.1,1.1,this.cx,this.cy);if(this.label){this.label[0].stop();this.label[0].attr({r:7.5});this.label[1].attr({"font-weight":800})}},function(){this.sector.animate({transform:"s1 1 "+this.cx+" "+this.cy},500,"bounce");if(this.label){this.label[0].animate({r:5},500,"bounce");this.label[1].attr({"font-weight":400})}});break;case"dot":u.gR=x.dotchart(w/8,v/8,w*0.8,v*0.8,u.x.data,u.y.data,u.data,{symbol:"o",max:10,heat:true,axis:"0 0 1 1",axisxstep:u.x.data.length-1,axisystep:u.y.data.length-1,axisxlabels:(u.x.legend?u.x.legend:u.x.data),axisylabels:(u.y.legend?u.y.legend:u.y.data),axisxtype:" ",axisytype:" "}).hover(function(){this.marker=this.marker||x.tag(this.x,this.y,this.value,0,this.r+2).insertBefore(this);this.marker.show()},function(){this.marker&&this.marker.hide()});break}u.gR.mousedown(function(){u.td.mousedown().mouseup()});u.chart.mousemove(function(){u.td.mousemove();return false})});return u.chart}};var e=h.sheet.fn={ISNUMBER:function(s){var r;if(!isNaN(s.valueOf())){r=new g(true);r.html="TRUE";return r}r=new g(false);r.html="FALSE";return r},N:function(r){if(r==null){return 0}if(r instanceof l){return r.getTime()}if(typeof(r)=="object"){r=r.toString()}if(typeof(r)=="string"){r=parseFloat(r.replace(d.regEx.n,""))}if(isNaN(r)){return 0}if(typeof(r)=="number"){return r}if(r==true){return 1}return 0},VERSION:function(){return this.jS.version},ABS:function(r){return c.abs(e.N(r))},CEILING:function(s,r){r=r||1;return(parseInt(s/r)*r)+r},EVEN:function(r){r=c.round(r);var s=(r%2==0);if(!s){if(r>0){r++}else{r--}}return r},EXP:function(r){return c.exp(r)},FLOOR:function(t,s){s=s||1;if((t<0&&s>0)||(t>0&&s<0)){var r=new k(0);r.html="#NUM";return r}if(t>=0){return c.floor(t/s)*s}else{return c.ceil(t/s)*s}},INT:function(r){return c.floor(e.N(r))},LN:function(r){return c.log(r)},LOG:function(r,s){s=s||10;return c.log(r)/c.log(s)},LOG10:function(r){return e.LOG(r)},MOD:function(r,t){var s=r%t;if(t<0){s*=-1}return s},ODD:function(r){var t=false;if(r>0){r=c.floor(c.round(r));t=true}else{r=c.ceil(r)}var s=c.abs(r);if((s%2)==0){s++}if(t){return s}else{return -s}},PI:function(){return c.PI},POWER:function(r,s){return c.pow(r,s)},SQRT:function(r){return c.sqrt(r)},RAND:function(){return c.random()},RND:function(){return c.random()},ROUND:function(t,s){var r=c.pow(10,s||0);return c.round(t*r)/r},ROUNDDOWN:function(s,r){var t=(s<0);s=c.abs(s);r=r||0;s=c.floor(s*c.pow(10,r))/c.pow(10,r);return(t?-s:s)},ROUNDUP:function(s,r){var t=(s<0);s=c.abs(s);r=r||0;s=c.ceil(s*c.pow(10,r))/c.pow(10,r);return(t?-s:s)},SUM:function(){var t=0,r=f.toNumbers(arguments),s=r.length-1;if(s<0){return 0}do{t+=r[s]*1}while(s--);return t},TRUNC:function(r,s){s=s||0;r=r+"";if(s==0){return r.split(".").shift()}if(r.match(".")){if(s==1){r=r.substr(0,r.length-1)}else{if(s==-1){r=r.split(".").shift();r=r.substr(0,r.length-1)+"0"}}}return r},AVERAGE:function(r){return e.SUM(arguments)/e.COUNT(arguments)},AVG:function(r){return e.AVERAGE(r)},COUNT:function(){var t=0,r=f.toNumbers(arguments),s=r.length-1;if(s<0){return t}do{if(r[s]!==null){t++}}while(s--);return t},COUNTA:function(){var t=0,r=f.flatten(arguments),s=r.length-1;if(s<0){return t}do{if(r[s]){t++}}while(s--);return t},MAX:function(){var s=f.toNumbers(arguments),r=s[0],t=s.length-1;if(t<0){return 0}do{r=(s[t]>r?s[t]:r)}while(t--);return r},MIN:function(){var r=f.toNumbers(arguments),t=r[0],s=r.length-1;if(s<0){return 0}do{t=(r[s]<t?r[s]:t)}while(s--);return t},ASC:function(r){return r.charCodeAt(0)},CHAR:function(r){return n.fromCharCode(r)},CLEAN:function(r){var s=new q("[cG\x1BcLcJcMcIcK\x07\x1B\f\n\r\t\v]","g");return r.replace(s,"")},CODE:function(r){return e.ASC(r)},CONCATENATE:function(){var t=f.flatten(arguments),s="",r=this;jQuery.each(t,function(u){s+=t[u]});return s},DOLLAR:function(u,t,x){t=t||2;x=x||"$";var s=new k(u),w=e.FIXED(u,t,false);if(u>=0){s.html=x+w}else{s.html="("+x+w.slice(1)+")"}return s},FIXED:function(u,t,s){t=(t===undefined?2:t);var w=c.pow(10,t),r,u=c.round(u*w)/w;r=new n(u.toFixed(t));r.html=Globalize.format(u,"n"+t);if(s){r.html=r.html.replace(Globalize.culture().numberFormat[","],"")}return r},LEFT:function(r,s){s=s||1;return r.substring(0,s)},LEN:function(r){if(!r){return 0}return r.length},LOWER:function(r){return r.toLowerCase()},MID:function(s,t,r){if(!s||!t||!r){return this.jS.s.error({error:"ERROR"})}return s.substring(t-1,r+t-1)},REPLACE:function(s,v,t,u){if(!s||!v||!t||!u){return this.jS.s.error({error:"ERROR"})}var r=s.split("");r.splice(v-1,t);r.splice(v-1,0,u);return r.join("")},REPT:function(s,u){var r="";for(var t=0;t<u;t++){r+=s}return r},RIGHT:function(r,s){s=s||1;return r.substring(r.length-s,r.length)},SEARCH:function(t,r,u){u=u||0;if(u){r=r.split("");r.splice(0,u-1);r=r.join("")}var s=r.search(t);if(s<0){return this.jS.s.error({error:"#VALUE!"})}return u+(u?0:1)+s},SUBSTITUTE:function(u,r,t,v){v=v||0;r=new q(r,"g");var s=1;u=u.replace(r,function(x,z,A,y){var w=x;if(v){if(s>=v){w=t}}else{w=t}s++;return w});return u},TEXT:function(){return this.jS.s.error({error:"Not Yet Implemented"})},UPPER:function(r){return r.toUpperCase()},VALUE:function(r){if(jQuery.isNumeric(r)){return r*=1}else{return this.jS.s.error({error:"#VALUE!"})}},NOW:function(){var r=new l();r.html=b.toString(r);return r},TODAY:function(){var s=new l(),r=new k(b.toCentury(s)-1);r.html=b.toString(s,"d");return r},WEEKENDING:function(s){var r=new l();r=new l(r.getFullYear(),r.getMonth(),r.getDate()+5-r.getDay()-((s||0)*7));r.html=b.toString(r,"d");return r},WEEKDAY:function(s,t){s=b.get(s);var r=s.getDay();t=(t?t:1);switch(t){case 3:switch(r){case 0:return 7;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 6}break;case 2:switch(r){case 0:return 6;case 1:return 0;case 2:return 1;case 3:return 2;case 4:return 3;case 5:return 4;case 6:return 5}break;case 1:r++;break}return r},WEEKNUM:function(r){r=b.get(r);return b.week(r)+1},YEAR:function(r){r=b.get(r);return r.getFullYear()},DAYSFROM:function(s,t,r){return c.floor((new l()-new l(s,(t-1),r))/b.dayDiv)},DAYS:function(v,t){var s=b.get(v),r=b.get(t),u=1000*60*60*24;return c.round(c.abs(s.getTime()-r.getTime())/u)},DAY:function(r){r=b.get(r);return r.getDate()},DAYS360:function(w,t,y){w=b.get(w);t=b.get(t);var r=w.getDate(),v=t.getDate(),u=b.isLastDayOfMonth(w),x=b.isLastDayOfMonth(t),s=b.diffMonths(w,t);if(y){r=c.min(r,30);v=c.min(v,30)}else{if(u){r=30}if(x){if(r<30){s++;v=1}else{v=30}}}return(s*30)+(v-r)},DATE:function(u,v,s){var t=new l(u,v-1,s),r=new k(b.toCentury(t));r.html=b.toString(t,"d");return r},DATEVALUE:function(s){s=b.get(s);var r=new k(b.toCentury(s));r.html=b.toString(s,"d");return r},EDATE:function(t,s){t=b.get(t);t.setMonth(t.getMonth()+s);var r=new k(b.toCentury(t));r.html=b.toString(t,"d");return r},EOMONTH:function(t,s){t=b.get(t);t.setMonth(t.getMonth()+s+1);t=new l(t.getFullYear(),t.getMonth(),0);var r=new k(b.toCentury(t));r.html=b.toString(t,"d");return r},HOUR:function(r){r=a.fromMath(r);return r.hour},MINUTE:function(r){return a.fromMath(r).minute},MONTH:function(r){r=b.get(r);return r.getMonth()+1},SECOND:function(r){return a.fromMath(r).second},TIME:function(r,w,s){s=(s?s:0);w=(w?w:0);r=(r?r:0);if(s&&s>60){var t=(((s/60)+"").split(".")[0])*1;s=s-(t*60);w+=t}if(w&&w>60){var v=(((w/60)+"").split(".")[0])*1;w=w-(v*60);r+=v}var u=(r*60*60*1000)+(w*60*1000)+(s*1000);return u/b.dayDiv},TIMEVALUE:function(r){if(!isNaN(r)){return r}if(/([0]?[1-9]|1[0-2])[:][0-5][0-9]([:][0-5][0-9])?[ ]?(AM|am|aM|Am|PM|pm|pM|Pm)/.test(r)){return a.fromString(r,true)}else{if(/([0]?[0-9]|1[0-9]|2[0-3])[:][0-5][0-9]([:][0-5][0-9])?/.test(r)){return a.fromString(r)}}return 0},WORKDAY:function(s,v,u){var w={1:true,2:true,3:true,4:true,5:true},s=b.get(s),v=(v&&!isNaN(v)?v:0),x=0,t=0,r=s,z;if(u){if(!jQuery.isArray(u)){u=[u]}u=f.flatten(u);var y={};jQuery.each(u,function(A){if(u[A]){y[b.toString(b.get(u[A]),"d")]=true}});u=y}else{u={}}while(t<v){r=new l(r.setDate(r.getDate()+1));if(w[r.getDay()]){if(!u[b.toString(r,"d")]){t++}}x++}z=new k(b.toCentury(r));z.html=b.toString(r,"d");return z},YEARFRAC:function(r,v,u){r=b.get(r);v=b.get(v);if(!r||!v){return this.jS.s.error({error:"#VALUE!"})}u=(u?u:0);this.html=[];var t=b.diff(r,v,u),s=b.calcAnnualBasis(r,v,u);return t/s},AND:function(){var s=arguments,t,r=this;h.each(s,function(u){if(s[u].valueOf()!==true&&t==undefined){t=e.FALSE()}});if(!t){t=e.TRUE()}return t},FALSE:function(){var r=new g(false);r.html="FALSE";return r},IF:function(t,s,r){if(t.valueOf()){return s}else{return r}},NOT:function(s){var r;if(!s.valueOf()){r=new g(true);r.html="TRUE"}else{r=new g(false);r.html="FALSE"}return r},OR:function(){var t=arguments,r,u=t.length-1,s;if(u>-1){do{s=t[u].valueOf();if(s){r=new g(true);r.html="TRUE";return r}}while(u--)}r=new g(false);r.html="FALSE";return r},TRUE:function(){var r=new g(true);r.html="TRUE";return r},GREATER:function(t,s){var r;if(t>s){r=new g(true);r.html="TRUE"}else{r=new g(false);r.html="FALSE"}return r},LESS:function(t,s){var r;if(t<s){r=new g(true);r.html="TRUE"}else{r=new g(false);r.html="FALSE"}return r},EQUAL:function(t,s){var r;if(t.valueOf()==s.valueOf()){r=new g(true);r.html="TRUE"}else{r=new g(false);r.html="FALSE"}return r},GREATER_EQUAL:function(t,s){var r;if(t>=s){r=new g(true);r.html="TRUE"}else{r=new g(false);r.html="FALSE"}return r},LESS_EQUAL:function(t,s){var r;if(t<=s){r=new g(true);r.html="TRUE"}else{r=new g(false);r.html="FALSE"}return r},IMG:function(s){var r=new n("");r.html=h(o.createElement("img")).attr("src",s);return r},TRIM:function(r){if(typeof(r)=="string"){r=h.trim(r)}return r},HYPERLINK:function(t,s){s=s||"LINK";var r=new n(s);r.html=h(o.createElement("a")).attr("href",t).attr("target","_new").text(s);return r},DROPDOWN:function(){var B=this,x=this.jS,A,w=this.td.children().detach(),y,t=h(B.td),z,s,C;if(!w.length||B.needsUpdated){A=f.flatten(arguments);A=f.unique(A);y=x.getTdLocation(B.td);s="dropdown"+this.sheet+"_"+y.row+"_"+y.col+"_"+x.I;z=o.createElement("select");z.setAttribute("name",s);z.setAttribute("id",s);z.className="jSDropdown";z.cell=this;z.onmouseup=function(){x.cellEdit(t)};z.onchange=function(){B.value=this.value;x.calcDependencies.call(B,B.calcDependenciesLast)};x.controls.inputs[x.i]=x.obj.inputs().add(z);for(var u=0;u<(A.length<=50?A.length:50);u++){if(A[u]){var r=o.createElement("option");r.setAttribute("value",A[u]);r.text=r.innerText=A[u];z.appendChild(r)}}if(!x.s.editable){z.setAttribute("disabled",true)}else{x.s.parent.bind("sheetKill",function(){t.text(B.value=z.value)})}z.value=B.value||A[0];z.onchange()}if(typeof B.value!="object"){C=new n(B.value)}C.html=z;return C},RADIO:function(){var E=this,y=this.jS,D,x=this.td.children().detach(),A,t,z,r,u,s,F;if(!x.length||E.needsUpdated){D=f.flatten(arguments);D=f.unique(D);A=y.getTdLocation(E.td);t=h(E.td);z=[];s="radio"+this.sheet+"_"+A.row+"_"+A.col+"_"+y.I;u=o.createElement("span");u.className="jSRadio";u.onmousedown=function(){y.cellEdit(t)};u.jSCell=E;y.controls.inputs[y.i]=y.obj.inputs().add(u);for(var w=0;w<(D.length<=25?D.length:25);w++){if(D[w]){var C=o.createElement("input"),B=o.createElement("span");C.setAttribute("type","radio");C.setAttribute("name",s);C.className=s;C.value=D[w];C.onchange=function(){E.value=jQuery(this).val();y.calcDependencies.call(E,E.calcDependenciesLast)};z.push(C);if(D[w]==E.value){C.setAttribute("checked","true");C.onchange()}B.textContent=B.innerText=D[w];u.appendChild(C);u.input=C;B.onclick=function(){h(this).prev().click()};u.appendChild(B);u.appendChild(o.createElement("br"))}}r=h(z);if(!y.s.editable){E.value=r.filter(":checked").val();r.attr("disabled",true)}else{y.s.parent.bind("sheetKill",function(){E.value=r.filter(":checked").val();t.text(E.value)})}}if(typeof E.value!="object"){F=new n(E.value)}F.html=u;return F},CHECKBOX:function(z){if(h.isArray(z)){z=z[0]}var A=this,u=this.jS,t=this.td.children().detach(),x,w,s,y,r,B;if((!t.length||A.needsUpdated)){x=u.getTdLocation(A.td);w=h([]);s=h(A.td);r="checkbox"+this.sheet+"_"+x.row+"_"+x.col+"_"+u.I;w=o.createElement("input");w.setAttribute("type","checkbox");w.setAttribute("name",r);w.className=r;w.value=z;w.onchange=function(){if(h(this).is(":checked")){A.value=z}else{A.value=""}u.calcDependencies.call(A,A.calcDependenciesLast)};if(!u.s.editable){w.setAttribute("disabled","true")}else{u.s.parent.bind("sheetKill",function(){A.value=(A.value=="true"||h(w).is(":checked")?z:"");s.text(A.value)})}t=o.createElement("span");t.className="SCheckbox";t.appendChild(w);y=o.createElement("span");y.textContent=y.innerText=z;t.appendChild(y);t.appendChild(o.createElement("br"));t.onmousedown=function(){u.cellEdit(s)};t.cell=A;u.controls.inputs[u.i]=u.obj.inputs().add(t);if(z==A.value){w.setAttribute("checked",true);w.onchange()}}B=new n(A.value=="true"||h(w).is(":checked")?z:"");B.html=t;return B},BARCHART:function(s,t,u){var r=new n("");r.html=d.chart.call(this,{type:"bar",data:s,legend:t,title:u});return r},HBARCHART:function(s,t,u){var r=new n("");r.html=d.chart.call(this,{type:"hbar",data:s,legend:t,title:u});return r},LINECHART:function(t,s){var r=new n("");r.html=d.chart.call(this,{type:"line",x:{data:t},y:{data:s},title:""});return r},PIECHART:function(s,t,u){var r=new n("");r.html=d.chart.call(this,{type:"pie",data:s,legend:t,title:u});return r},DOTCHART:function(x,v,s,u,t,w){var r=new n("");r.html=d.chart.call(this,{type:"dot",data:(s?s:x),x:{data:x,legend:u},y:{data:(v?v:x),legend:(t?t:u)},title:w});return r},CELLREF:function(r){return(this.jS.spreadsheets[r]?this.jS.spreadsheets[r]:"Cell Reference Not Found")},CALCTIME:function(){var r=this;this.s.parent.one("sheetCalculation",function(){r.td.text(r.jS.time.diff())});return""},HLOOKUP:function(y,w,v,s){var x=this.jS,u=this.jS.cellLookup.call(this),r={html:"#N/A",value:""};v=v||1;s=s!==undefined?s:true;if(isNaN(y)){var t=w[0].indexOf(y);if(t>-1){r=x.updateCellValue(u[t].sheet,v,x.getTdLocation(u[t].td).col)}}else{f.getClosestNum(y,w[0],function(B,A){var z=x.updateCellValue(u[A].sheet,v,x.getTdLocation(u[A].td).col);if(s){r=z}else{if(z==y){r=z}}})}return r},VLOOKUP:function(y,w,v,s){var x=this.jS,u=this.jS.cellLookup.call(this),r={html:"#N/A",value:""};s=s!==undefined?s:true;if(isNaN(y)){var t=w[0].indexOf(y);if(t>-1){r=x.updateCellValue(u[t].sheet,v,x.getTdLocation(u[t].td).col)}}else{f.getClosestNum(y,w[0],function(B,A){var z=x.updateCellValue(u[A].sheet,x.getTdLocation(u[A].td).row,v);if(s){r=z}else{if(z==y){r=z}}})}return r},THISROWCELL:function(r){var s=this.jS,t=s.getTdLocation(this.td);if(isNaN(r)){r=d.columnLabelIndex(r)}return s.updateCellValue(this.sheet,t.row,r)},THISCOLCELL:function(t){var r=this.jS,s=r.getTdLocation(this.td);return r.updateCellValue(this.sheet,t,s.col)}};var p={BACKSPACE:8,CAPS_LOCK:20,COMMA:188,CONTROL:17,ALT:18,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,C:67,F:70,V:86,X:88,Y:89,Z:90};var f=j.arrHelpers={math:c,toNumbers:function(r){r=this.flatten(r);var s=r.length-1;if(s<0){return[]}do{if(r[s]){r[s]=h.trim(r[s]);if(isNaN(r[s])){r[s]=0}else{r[s]=r[s]*1}}else{r[s]=0}}while(s--);return r},unique:function(r){var t=[],s=r.length;for(var v=0;v<s;v++){for(var u=v+1;u<s;u++){if(r[v]===r[u]){u=++v}}t.push(r[v])}return t},flatten:function(r){var v=[];for(var t=0,s=r.length;t<s;t++){var u=Object.prototype.toString.call(r[t]).split(" ").pop().split("]").shift().toLowerCase();if(u){v=v.concat(/^(array|collection|arguments|object)$/.test(u)?this.flatten(r[t]):r[t])}}return v},insertAt:function(r,t,s){h(t).each(function(){if(s>-1&&s<=r.length){r.splice(s,0,this)}});return r},closest:function(v,s,t,r){v=v||[];s=s||0;t=t||0;r=r||v.length-1;var u;while(true){u=((t+r)>>1);if(u===r||u===t){return v[u]}if(v[u]>s){r=u}else{if(v[u]<s){t=u}else{return v[u]}}}},getClosestNum:function(t,r,v){var u=0,s,y,x,w;if(r.length){y=r[0];s=u;for(u;u<r.length;u++){x=c.abs(t-y);w=c.abs(t-r[u]);if(w<x){s=u;y=r[u]}x=null;w=null}if(v){return v(y,s)}return y}return false}};var b={dayDiv:86400000,math:c,toCentury:function(r,s){s=s||86400000;return this.math.round(this.math.abs((new l(1900,0,-1))-r)/s)},get:function(s,t){t=t||86400000;if(s.getMonth){return s}else{if(isNaN(s)){return new l(Globalize.parseDate(s))}else{s*=t;var r=(new l(1900,0,-1))*1;s+=r;s=new l(s);return s}}},week:function(r,t){t=t||86400000;var s=new l(r.getFullYear(),0,1);return this.math.ceil((((r-s)/t)+s.getDay()+1)/7)},toString:function(r,s){if(!s){return Globalize.format(r)}return Globalize.format(r,Globalize.culture().calendar.patterns[s])},diff:function(v,s,u,t){t=t||86400000;switch(u){case 0:return this.days360Nasd(v,s,0,true);case 1:case 2:case 3:var r=this.math.abs(s-v)/t;return r;case 4:return this.days360Euro(v,s)}return 0},diffMonths:function(t,s){var r;r=(s.getFullYear()-t.getFullYear())*12;r-=t.getMonth()+1;r+=s.getMonth()+1;return r},days360:function(t,w,u,s,r,v){return((w-t)*360)+((s-u)*30)+(v-r)},days360Nasd:function(s,v,r,t){var u=s.getDate(),z=s.getMonth(),y=s.getFullYear(),x=v.getDate(),w=v.getMonth(),A=v.getFullYear();if((w==2&&this.isEndOfMonth(x,w,A))&&((z==2&&this.isEndOfMonth(u,z,y))||r==3)){x=30}if(x==31&&(u>=30||r==3)){x=30}if(u==31){u=30}if(t&&z==2&&this.isEndOfMonth(u,z,y)){u=30}return this.days360(y,A,z,w,u,x)},days360Euro:function(y,t){var r=y.getDate(),v=y.getMonth(),u=y.getFullYear(),w=t.getDate(),s=t.getMonth(),x=t.getFullYear();if(r==31){r=30}if(w==31){w=30}return this.days360(u,x,v,s,r,w)},isEndOfMonth:function(r,t,s){return r==(new l(s,t+1,0,23,59,59)).getDate()},isLeapYear:function(r){return new l(r,1,29).getMonth()==1},calcAnnualBasis:function(r,t,x){switch(x){case 0:case 2:case 4:return 360;case 3:return 365;case 1:var s=r.getDate(),z=r.getMonth(),w=r.getFullYear(),u=t.getDate(),v=t.getMonth(),A=t.getFullYear(),B=0;if(w==A){if(this.isLeapYear(w)){B=366}else{B=365}}else{if(((A-1)==w)&&((z>v)||((z==v)&&s>=u))){if(this.isLeapYear(w)){if(z<2||(z==2&&s<=29)){B=366}else{B=365}}else{if(this.isLeapYear(A)){if(v>2||(v==2&&u==29)){B=366}else{B=365}}else{B=365}}}else{for(var y=w;y<=A;y++){if(this.isLeapYear(y)){B+=366}else{B+=365}}B=B/(A-w+1)}}return B}return 0},lastDayOfMonth:function(r){r.setDate(0);return r.getDate()},isLastDayOfMonth:function(r){return(r.getDate()==this.lastDayOfMonth(r))}};var a=j.times={math:c,fromMath:function(t){var r={},s=this;r.hour=((t*24)+"").split(".")[0]*1;r.minute=function(u){u=s.math.round(u*24*100)/100;u=(u+"").split(".");var v=0;if(u[1]){if(u[1].length<2){u[1]+="0"}v=u[1]*0.6}return s.math.round(v)}(t);r.second=function(x){x=s.math.round(x*24*10000)/10000;x=(x+"").split(".");var v=0;if(x[1]){for(var w=0;w<4;w++){if(!x[1].charAt(w)){x[1]+="0"}}var u=((x[1]*0.006)+"").split(".");if(u[1]){if(u[1]&&u[1].length>2){u[1]=u[1].substr(0,2)}return s.math.round(u[1]*0.6)}}return v}(t);return r},fromString:function(t,x){var u=new l(),y=t,r,w,v,s,z;if(x){z=y.substr(-2).toLowerCase();y=y.replace(/(am|pm)/i,"")}y=y.split(":");w=y[0]*1;v=y[1]*1;s=(y[2]?y[2]:0)*1;if(x&&z=="pm"){w+=12}return e.TIME(w,v,s)}};var m=j.math=h.extend(j.math,{log10:function(r){return c.log(r)/2.302585092994046},signum:function(r){return(r/c.abs(r))||r},log1p:function(r){var s=0,u=50;if(r<=-1){return"-INF"}if(r<0||r>1){return c.log(1+r)}for(var t=1;t<u;t++){if((t%2)===0){s-=c.pow(r,t)/t}else{s+=c.pow(r,t)/t}}return s}});h.print=function(t){var r=j.open();r.doc.write("<html><body><xmp>"+t+"\n</xmp></body></html>");r.doc.close()};if(!Object.getPrototypeOf){Object.getPrototypeOf=function(r){return r||{}}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(t,u){for(var s=(u||0),r=this.length;s<r;s++){if(this[s]===t){return s}}return -1}}})(jQuery,document,window,Date,String,Number,Boolean,Math,RegExp,Error);